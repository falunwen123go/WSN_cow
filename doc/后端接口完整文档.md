# WSNç‰›èˆç›‘æµ‹ç³»ç»Ÿ - åç«¯æ¥å£å®Œæ•´æ–‡æ¡£

> **ç”Ÿæˆæ—¥æœŸ**: 2025-11-18  
> **ç‰ˆæœ¬**: v1.0  
> **åç«¯æ¡†æ¶**: Spring Boot 2.7.18  
> **æ•°æ®åº“**: MySQL 8.0+  
> **ç«¯å£**: 9090  
> **åŸºç¡€URL**: `http://localhost:9090`

---

## ğŸ“‹ ç›®å½•

1. [ç»Ÿä¸€å“åº”ç»“æ„](#ç»Ÿä¸€å“åº”ç»“æ„)
2. [å®ä½“ç±»å­—æ®µæ˜ å°„](#å®ä½“ç±»å­—æ®µæ˜ å°„)
3. [APIæ¥å£æ¸…å•](#apiæ¥å£æ¸…å•)
4. [å‰ç«¯ç±»å‹å®šä¹‰å‚è€ƒ](#å‰ç«¯ç±»å‹å®šä¹‰å‚è€ƒ)

---

## 1. ç»Ÿä¸€å“åº”ç»“æ„

### Result<T> - ç»Ÿä¸€è¿”å›ç»“æœ

æ‰€æœ‰APIæ¥å£è¿”å›çš„æ•°æ®éƒ½éµå¾ªä»¥ä¸‹ç»“æ„ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { },
  "timestamp": 1700293847123
}
```

**å­—æ®µè¯´æ˜**:
- `code` (Integer): çŠ¶æ€ç 
  - `200`: æˆåŠŸ
  - `400`: å‚æ•°é”™è¯¯
  - `404`: èµ„æºæœªæ‰¾åˆ°
  - `500`: æœåŠ¡å™¨é”™è¯¯
- `message` (String): è¿”å›æ¶ˆæ¯
- `data` (T): è¿”å›æ•°æ®ï¼ˆæ³›å‹ï¼Œæ ¹æ®æ¥å£ä¸åŒè€Œä¸åŒï¼‰
- `timestamp` (Long): æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

### PageResult<T> - åˆ†é¡µç»“æœ

åˆ†é¡µæ¥å£è¿”å›çš„dataå­—æ®µç»“æ„ï¼š

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "records": [],
    "total": 100,
    "size": 10,
    "current": 1,
    "pages": 10
  },
  "timestamp": 1700293847123
}
```

**PageResultå­—æ®µè¯´æ˜**:
- `records` (Array): å½“å‰é¡µæ•°æ®åˆ—è¡¨
- `total` (Long): æ€»è®°å½•æ•°
- `size` (Integer): æ¯é¡µå¤§å°
- `current` (Integer): å½“å‰é¡µç 
- `pages` (Integer): æ€»é¡µæ•°

---

## 2. å®ä½“ç±»å­—æ®µæ˜ å°„

### 2.1 SensorData (ä¼ æ„Ÿå™¨æ•°æ®)

**Javaç±»**: `com.wsn.cow.entity.SensorData`  
**æ•°æ®åº“è¡¨**: `sensor_data`

| Javaå­—æ®µ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ | å‰ç«¯TypeScriptç±»å‹ |
|---------|-----------|------|------|------------------|
| id | id | Long | ä¸»é”®ID | number |
| nodeId | node_id | String | èŠ‚ç‚¹ID | string |
| temperature | temperature | Double | æ¸©åº¦(â„ƒ) | number |
| humidity | humidity | Double | æ¹¿åº¦(%) | number |
| nh3Concentration | nh3_concentration | Double | æ°¨æ°”æµ“åº¦(ppm) | number |
| h2sConcentration | h2s_concentration | Double | ç¡«åŒ–æ°¢æµ“åº¦(ppm) | number |
| dataStatus | data_status | Integer | æ•°æ®çŠ¶æ€(0-æ­£å¸¸,1-å¼‚å¸¸) | number |
| collectTime | collect_time | Date | é‡‡é›†æ—¶é—´ | string |
| createTime | create_time | Date | åˆ›å»ºæ—¶é—´ | string |

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- âœ… å­—æ®µåæ˜¯ `nh3Concentration`ï¼ˆä¸æ˜¯ammoniaï¼‰
- âœ… å­—æ®µåæ˜¯ `h2sConcentration`ï¼ˆä¸æ˜¯h2sæˆ–lightï¼‰
- âœ… `nodeId`æ˜¯Stringç±»å‹ï¼ˆä¸æ˜¯numberï¼‰
- âœ… æ—¥æœŸæ—¶é—´æ ¼å¼: `yyyy-MM-dd HH:mm:ss`

---

### 2.2 NodeInfo (èŠ‚ç‚¹ä¿¡æ¯)

**Javaç±»**: `com.wsn.cow.entity.NodeInfo`  
**æ•°æ®åº“è¡¨**: `node_info`

| Javaå­—æ®µ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ | å‰ç«¯TypeScriptç±»å‹ |
|---------|-----------|------|------|------------------|
| id | id | Long | ä¸»é”®ID | number |
| nodeId | node_id | String | èŠ‚ç‚¹ID | string |
| nodeName | node_name | String | èŠ‚ç‚¹åç§° | string |
| location | location | String | å®‰è£…ä½ç½® | string |
| status | status | Integer | èŠ‚ç‚¹çŠ¶æ€(0-ç¦»çº¿,1-åœ¨çº¿,2-æ•…éšœ) | number |
| batteryLevel | battery_level | Integer | ç”µæ± ç”µé‡(%) | number |
| signalStrength | signal_strength | Integer | ä¿¡å·å¼ºåº¦ | number |
| lastCommTime | last_comm_time | Date | æœ€åé€šä¿¡æ—¶é—´ | string |
| installDate | install_date | Date | å®‰è£…æ—¥æœŸ | string |
| remark | remark | String | å¤‡æ³¨ | string |
| lastOnlineTime | last_online_time | Date | æœ€ååœ¨çº¿æ—¶é—´ | string |
| createTime | create_time | Date | åˆ›å»ºæ—¶é—´ | string |
| updateTime | update_time | Date | æ›´æ–°æ—¶é—´ | string |

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- âœ… çŠ¶æ€å­—æ®µåæ˜¯ `status`ï¼ˆä¸æ˜¯nodeStatusï¼‰
- âœ… `nodeId`æ˜¯Stringç±»å‹ï¼ˆä¸æ˜¯numberï¼‰
- âŒ æ²¡æœ‰`nodeType`å­—æ®µ

---

### 2.3 AlarmRecord (å‘Šè­¦è®°å½•)

**Javaç±»**: `com.wsn.cow.entity.AlarmRecord`  
**æ•°æ®åº“è¡¨**: `alarm_record`

| Javaå­—æ®µ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ | å‰ç«¯TypeScriptç±»å‹ |
|---------|-----------|------|------|------------------|
| id | id | Long | ä¸»é”®ID | number |
| nodeId | node_id | String | èŠ‚ç‚¹ID | string |
| alarmType | alarm_type | String | å‘Šè­¦ç±»å‹(TEMP/HUMI/NH3/H2S) | string |
| alarmLevel | alarm_level | Integer | å‘Šè­¦çº§åˆ«(1-ä¸€èˆ¬,2-ä¸¥é‡,3-ç´§æ€¥) | number |
| currentValue | current_value | Double | å½“å‰å€¼ | number |
| threshold | threshold | Double | é˜ˆå€¼ | number |
| alarmTime | alarm_time | Date | å‘Šè­¦æ—¶é—´ | string |
| handleStatus | handle_status | Integer | å¤„ç†çŠ¶æ€(0-æœªå¤„ç†,1-å·²å¤„ç†) | number |
| handleTime | handle_time | Date | å¤„ç†æ—¶é—´ | string |
| handleRemark | handle_remark | String | å¤„ç†å¤‡æ³¨ | string |

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- âœ… çŠ¶æ€å­—æ®µåæ˜¯ `handleStatus`ï¼ˆä¸æ˜¯alarmStatusï¼‰
- âœ… `nodeId`æ˜¯Stringç±»å‹ï¼ˆä¸æ˜¯numberï¼‰
- âŒ æ²¡æœ‰`alarmContent`å­—æ®µï¼ˆéœ€å‰ç«¯æ ¹æ®alarmType/currentValue/thresholdåŠ¨æ€ç”Ÿæˆï¼‰
- âœ… `alarmType`æ˜¯Stringç±»å‹ï¼ˆTEMP/HUMI/NH3/H2Sï¼‰

---

### 2.4 DeviceInfo (è®¾å¤‡ä¿¡æ¯)

**Javaç±»**: `com.wsn.cow.entity.DeviceInfo`  
**æ•°æ®åº“è¡¨**: `device_info`

| Javaå­—æ®µ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ | å‰ç«¯TypeScriptç±»å‹ |
|---------|-----------|------|------|------------------|
| id | id | Long | ä¸»é”®ID | number |
| deviceId | device_id | String | è®¾å¤‡ID | string |
| deviceName | device_name | String | è®¾å¤‡åç§° | string |
| deviceType | device_type | String | è®¾å¤‡ç±»å‹(FAN/CURTAIN/HEATING/SPRAY) | string |
| status | status | Integer | è®¾å¤‡çŠ¶æ€(0-å…³é—­,1-è¿è¡Œ) | number |
| autoMode | auto_mode | Integer | è‡ªåŠ¨æ¨¡å¼(0-æ‰‹åŠ¨,1-è‡ªåŠ¨) | number |
| controlMode | control_mode | Integer | æ§åˆ¶æ¨¡å¼ | number |
| createTime | create_time | Date | åˆ›å»ºæ—¶é—´ | string |
| updateTime | update_time | Date | æ›´æ–°æ—¶é—´ | string |

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- âœ… çŠ¶æ€å­—æ®µåæ˜¯ `status`ï¼ˆä¸æ˜¯deviceStatusï¼‰
- âœ… `deviceId`æ˜¯Stringç±»å‹ï¼ˆä¸æ˜¯numberï¼‰
- âœ… æœ‰`autoMode`å­—æ®µï¼ˆ0-æ‰‹åŠ¨,1-è‡ªåŠ¨ï¼‰
- âŒ æ²¡æœ‰`nodeId`å­—æ®µ

---

### 2.5 DeviceControlLog (è®¾å¤‡æ§åˆ¶æ—¥å¿—)

**Javaç±»**: `com.wsn.cow.entity.DeviceControlLog`  
**æ•°æ®åº“è¡¨**: `device_control_log`

| Javaå­—æ®µ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ | å‰ç«¯TypeScriptç±»å‹ |
|---------|-----------|------|------|------------------|
| id | id | Long | ä¸»é”®ID | number |
| deviceId | device_id | String | è®¾å¤‡ID | string |
| controlAction | control_action | String | æ§åˆ¶åŠ¨ä½œ(START/STOP/ADJUST) | string |
| controlMode | control_mode | Integer | æ§åˆ¶æ¨¡å¼(0-æ‰‹åŠ¨,1-è‡ªåŠ¨) | number |
| operator | operator | String | æ“ä½œäºº | string |
| controlTime | control_time | Date | æ§åˆ¶æ—¶é—´ | string |
| reason | reason | String | åŸå› /å¤‡æ³¨ | string |

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- âœ… åŠ¨ä½œå­—æ®µåæ˜¯ `controlAction`ï¼ˆä¸æ˜¯actionï¼‰
- âœ… æ—¶é—´å­—æ®µåæ˜¯ `controlTime`ï¼ˆä¸æ˜¯operateTimeï¼‰
- âŒ æ•°æ®åº“ä¸­**æ²¡æœ‰**`before_status`å’Œ`after_status`å­—æ®µ

---

### 2.6 SystemConfig (ç³»ç»Ÿé…ç½®)

**Javaç±»**: `com.wsn.cow.entity.SystemConfig`  
**æ•°æ®åº“è¡¨**: `system_config`

| Javaå­—æ®µ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ | å‰ç«¯TypeScriptç±»å‹ |
|---------|-----------|------|------|------------------|
| id | id | Long | ä¸»é”®ID | number |
| configKey | config_key | String | é…ç½®é”® | string |
| configValue | config_value | String | é…ç½®å€¼ | string |
| description | description | String | é…ç½®è¯´æ˜ | string |
| configType | config_type | String | é…ç½®ç±»å‹(ALARM/SYSTEM/DEVICE) | string |
| createTime | create_time | Date | åˆ›å»ºæ—¶é—´ | string |
| updateTime | update_time | Date | æ›´æ–°æ—¶é—´ | string |

---

## 3. APIæ¥å£æ¸…å•

### 3.1 ä¼ æ„Ÿå™¨æ•°æ®æ¥å£ (/api/sensor)

#### 3.1.1 è·å–æ‰€æœ‰èŠ‚ç‚¹æœ€æ–°æ•°æ®
- **æ¥å£**: `GET /api/sensor/latest`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<List<SensorData>>`
- **è¯´æ˜**: è¿”å›æ‰€æœ‰èŠ‚ç‚¹çš„æœ€æ–°ä¼ æ„Ÿå™¨æ•°æ®

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "nodeId": "NODE001",
      "temperature": 25.5,
      "humidity": 60.2,
      "nh3Concentration": 15.3,
      "h2sConcentration": 5.1,
      "dataStatus": 0,
      "collectTime": "2025-11-18 10:30:00",
      "createTime": "2025-11-18 10:30:05"
    }
  ]
}
```

---

#### 3.1.2 è·å–æŒ‡å®šèŠ‚ç‚¹æœ€æ–°æ•°æ®
- **æ¥å£**: `GET /api/sensor/data/{nodeId}`
- **è·¯å¾„å‚æ•°**: 
  - `nodeId` (String): èŠ‚ç‚¹ID
- **è¿”å›**: `Result<SensorData>`

**è¯·æ±‚ç¤ºä¾‹**: `GET /api/sensor/data/NODE001`

---

#### 3.1.3 æŸ¥è¯¢å†å²æ•°æ®(åˆ†é¡µ)
- **æ¥å£**: `GET /api/sensor/history`
- **æŸ¥è¯¢å‚æ•°**:
  - `nodeId` (String, å¯é€‰): èŠ‚ç‚¹ID
  - `startTime` (String, å¯é€‰): å¼€å§‹æ—¶é—´ (æ ¼å¼: `yyyy-MM-dd HH:mm:ss`)
  - `endTime` (String, å¯é€‰): ç»“æŸæ—¶é—´
  - `pageNum` (Integer, å¯é€‰, é»˜è®¤1): é¡µç 
  - `pageSize` (Integer, å¯é€‰, é»˜è®¤10): æ¯é¡µå¤§å°
- **è¿”å›**: `Result<PageResult<SensorData>>`

**è¯·æ±‚ç¤ºä¾‹**: 
```
GET /api/sensor/history?nodeId=NODE001&startTime=2025-11-18 00:00:00&endTime=2025-11-18 23:59:59&pageNum=1&pageSize=20
```

---

#### 3.1.4 è·å–æ•°æ®ç»Ÿè®¡ä¿¡æ¯
- **æ¥å£**: `GET /api/sensor/statistics`
- **æŸ¥è¯¢å‚æ•°**:
  - `nodeId` (String, å¯é€‰): èŠ‚ç‚¹ID
  - `startTime` (String, å¯é€‰): å¼€å§‹æ—¶é—´ (æ ¼å¼: `yyyy-MM-dd`)
  - `endTime` (String, å¯é€‰): ç»“æŸæ—¶é—´
- **è¿”å›**: `Result<Map<String, Object>>`

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": {
    "avgTemperature": 25.3,
    "maxTemperature": 30.5,
    "minTemperature": 20.1,
    "avgHumidity": 62.5,
    "avgNh3": 18.2,
    "avgH2s": 6.3,
    "totalRecords": 1500
  }
}
```

---

### 3.2 èŠ‚ç‚¹ç®¡ç†æ¥å£ (/api/node)

#### 3.2.1 è·å–èŠ‚ç‚¹åˆ—è¡¨(åˆ†é¡µ)
- **æ¥å£**: `GET /api/node/list`
- **æŸ¥è¯¢å‚æ•°**:
  - `pageNum` (Integer, é»˜è®¤1): é¡µç 
  - `pageSize` (Integer, é»˜è®¤10): æ¯é¡µå¤§å°
- **è¿”å›**: `Result<List<NodeInfo>>`

---

#### 3.2.2 è·å–æ‰€æœ‰èŠ‚ç‚¹(ä¸åˆ†é¡µ) â­
- **æ¥å£**: `GET /api/node/all`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<List<NodeInfo>>`
- **è¯´æ˜**: **æ–°å¢æ¥å£**ï¼Œè¿”å›æ‰€æœ‰èŠ‚ç‚¹ï¼ˆæœ€å¤š1000æ¡ï¼‰

---

#### 3.2.3 è·å–èŠ‚ç‚¹çŠ¶æ€ç»Ÿè®¡ â­
- **æ¥å£**: `GET /api/node/status/stats`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<Map<String, Object>>`
- **è¯´æ˜**: **æ–°å¢æ¥å£**ï¼Œç»Ÿè®¡åœ¨çº¿/ç¦»çº¿èŠ‚ç‚¹æ•°é‡

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": {
    "online": 5,
    "offline": 2,
    "total": 7
  }
}
```

---

#### 3.2.4 è·å–åœ¨çº¿èŠ‚ç‚¹æ•°
- **æ¥å£**: `GET /api/node/online/count`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<Long>`

---

#### 3.2.5 è·å–èŠ‚ç‚¹è¯¦æƒ…
- **æ¥å£**: `GET /api/node/{nodeId}`
- **è·¯å¾„å‚æ•°**: 
  - `nodeId` (String): èŠ‚ç‚¹ID
- **è¿”å›**: `Result<NodeInfo>`

---

#### 3.2.6 æ·»åŠ èŠ‚ç‚¹
- **æ¥å£**: `POST /api/node`
- **è¯·æ±‚ä½“**: `NodeInfo`
- **è¿”å›**: `Result<String>`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "nodeId": "NODE004",
  "nodeName": "4å·èŠ‚ç‚¹",
  "location": "DåŒº",
  "status": 1,
  "batteryLevel": 85,
  "signalStrength": -60
}
```

---

#### 3.2.7 æ›´æ–°èŠ‚ç‚¹
- **æ¥å£**: `PUT /api/node/{nodeId}`
- **è·¯å¾„å‚æ•°**: `nodeId` (String)
- **è¯·æ±‚ä½“**: `NodeInfo`
- **è¿”å›**: `Result<String>`

---

#### 3.2.8 åˆ é™¤èŠ‚ç‚¹
- **æ¥å£**: `DELETE /api/node/{nodeId}`
- **è·¯å¾„å‚æ•°**: `nodeId` (String)
- **è¿”å›**: `Result<String>`

---

#### 3.2.9 è·å–ç½‘ç»œæ‹“æ‰‘
- **æ¥å£**: `GET /api/node/topology`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<List<NodeInfo>>`

---

### 3.3 å‘Šè­¦ç®¡ç†æ¥å£ (/api/alarm)

#### 3.3.1 è·å–å‘Šè­¦åˆ—è¡¨(åˆ†é¡µ)
- **æ¥å£**: `GET /api/alarm/list`
- **æŸ¥è¯¢å‚æ•°**:
  - `nodeId` (String, å¯é€‰): èŠ‚ç‚¹ID
  - `alarmType` (String, å¯é€‰): å‘Šè­¦ç±»å‹(TEMP/HUMI/NH3/H2S)
  - `alarmLevel` (Integer, å¯é€‰): å‘Šè­¦çº§åˆ«(1/2/3)
  - `handleStatus` (Integer, å¯é€‰): å¤„ç†çŠ¶æ€(0-æœªå¤„ç†,1-å·²å¤„ç†)
  - `startTime` (String, å¯é€‰): å¼€å§‹æ—¶é—´
  - `endTime` (String, å¯é€‰): ç»“æŸæ—¶é—´
  - `pageNum` (Integer, é»˜è®¤1): é¡µç 
  - `pageSize` (Integer, é»˜è®¤10): æ¯é¡µå¤§å°
- **è¿”å›**: `Result<PageResult<AlarmRecord>>`

**è¯·æ±‚ç¤ºä¾‹**:
```
GET /api/alarm/list?handleStatus=0&pageNum=1&pageSize=10
```

---

#### 3.3.2 è·å–æœªå¤„ç†å‘Šè­¦æ•°é‡
- **æ¥å£**: `GET /api/alarm/unhandled/count`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<Integer>`

---

#### 3.3.3 è·å–æœªå¤„ç†å‘Šè­¦åˆ—è¡¨
- **æ¥å£**: `GET /api/alarm/unhandled`
- **æŸ¥è¯¢å‚æ•°**:
  - `pageNum` (Integer, é»˜è®¤1)
  - `pageSize` (Integer, é»˜è®¤10)
- **è¿”å›**: `Result<PageResult<AlarmRecord>>`

---

#### 3.3.4 è·å–å‘Šè­¦è¯¦æƒ…
- **æ¥å£**: `GET /api/alarm/{id}`
- **è·¯å¾„å‚æ•°**: `id` (Long)
- **è¿”å›**: `Result<AlarmRecord>`

---

#### 3.3.5 åˆ›å»ºå‘Šè­¦è®°å½•
- **æ¥å£**: `POST /api/alarm`
- **è¯·æ±‚ä½“**: `AlarmRecord`
- **è¿”å›**: `Result<String>`

---

#### 3.3.6 å¤„ç†å‘Šè­¦
- **æ¥å£**: `PUT /api/alarm/handle/{id}`
- **è·¯å¾„å‚æ•°**: `id` (Long)
- **æŸ¥è¯¢å‚æ•°**:
  - `handleStatus` (Integer, é»˜è®¤1): å¤„ç†çŠ¶æ€
  - `handleRemark` (String, å¯é€‰): å¤„ç†å¤‡æ³¨
- **è¿”å›**: `Result<String>`

**è¯·æ±‚ç¤ºä¾‹**:
```
PUT /api/alarm/handle/123?handleStatus=1&handleRemark=å·²å¤„ç†
```

---

#### 3.3.7 æ‰¹é‡å¤„ç†å‘Šè­¦
- **æ¥å£**: `PUT /api/alarm/handle/batch`
- **æŸ¥è¯¢å‚æ•°**:
  - `ids` (String): å‘Šè­¦IDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
  - `handleStatus` (Integer, é»˜è®¤1)
  - `handleRemark` (String, å¯é€‰)
- **è¿”å›**: `Result<String>`

**è¯·æ±‚ç¤ºä¾‹**:
```
PUT /api/alarm/handle/batch?ids=1,2,3,4&handleStatus=1
```

---

#### 3.3.8 è·å–å‘Šè­¦ç»Ÿè®¡ä¿¡æ¯
- **æ¥å£**: `GET /api/alarm/statistics`
- **æŸ¥è¯¢å‚æ•°**:
  - `startTime` (String, å¯é€‰): å¼€å§‹æ—¶é—´ (æ ¼å¼: `yyyy-MM-dd`)
  - `endTime` (String, å¯é€‰): ç»“æŸæ—¶é—´
- **è¿”å›**: `Result<Map<String, Object>>`

---

#### 3.3.9 åˆ é™¤å†å²å‘Šè­¦
- **æ¥å£**: `DELETE /api/alarm/history`
- **æŸ¥è¯¢å‚æ•°**:
  - `beforeTime` (String, å¿…å¡«): åˆ é™¤æ­¤æ—¶é—´ä¹‹å‰çš„å‘Šè­¦
- **è¿”å›**: `Result<Integer>`

---

#### 3.3.10 åˆ é™¤å•æ¡å‘Šè­¦
- **æ¥å£**: `DELETE /api/alarm/{id}`
- **è·¯å¾„å‚æ•°**: `id` (Long)
- **è¿”å›**: `Result<String>`

---

### 3.4 è®¾å¤‡æ§åˆ¶æ¥å£ (/api/device)

#### 3.4.1 è·å–è®¾å¤‡åˆ—è¡¨
- **æ¥å£**: `GET /api/device/list`
- **æŸ¥è¯¢å‚æ•°**:
  - `deviceType` (String, å¯é€‰): è®¾å¤‡ç±»å‹(FAN/CURTAIN/HEATING/SPRAY)
- **è¿”å›**: `Result<List<DeviceInfo>>`

---

#### 3.4.2 è·å–æ‰€æœ‰è®¾å¤‡(ä¸åˆ†é¡µ) â­
- **æ¥å£**: `GET /api/device/all`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<List<DeviceInfo>>`
- **è¯´æ˜**: **æ–°å¢æ¥å£**

---

#### 3.4.3 è·å–è®¾å¤‡çŠ¶æ€ç»Ÿè®¡ â­
- **æ¥å£**: `GET /api/device/status/stats`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<Map<String, Object>>`
- **è¯´æ˜**: **æ–°å¢æ¥å£**

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": {
    "online": 8,
    "offline": 2,
    "total": 10
  }
}
```

---

#### 3.4.4 è·å–è®¾å¤‡è¯¦æƒ…
- **æ¥å£**: `GET /api/device/{deviceId}`
- **è·¯å¾„å‚æ•°**: `deviceId` (String)
- **è¿”å›**: `Result<DeviceInfo>`

---

#### 3.4.5 æ‰‹åŠ¨æ§åˆ¶è®¾å¤‡
- **æ¥å£**: `POST /api/device/control`
- **è¯·æ±‚ä½“**:
```json
{
  "deviceId": "DEV001",
  "action": "START",
  "operator": "Admin"
}
```
- **actionå–å€¼**: `START` | `STOP`
- **è¿”å›**: `Result<String>`

---

#### 3.4.6 åˆ‡æ¢æ§åˆ¶æ¨¡å¼
- **æ¥å£**: `PUT /api/device/{deviceId}/mode`
- **è·¯å¾„å‚æ•°**: `deviceId` (String)
- **è¯·æ±‚ä½“**:
```json
{
  "autoMode": 1
}
```
- **autoModeå–å€¼**: `0`(æ‰‹åŠ¨) | `1`(è‡ªåŠ¨)
- **è¿”å›**: `Result<String>`

---

#### 3.4.7 æŸ¥è¯¢æ§åˆ¶æ—¥å¿—
- **æ¥å£**: `GET /api/device/log`
- **æŸ¥è¯¢å‚æ•°**:
  - `deviceId` (String, å¯é€‰)
  - `controlType` (String, å¯é€‰)
  - `startTime` (String, å¯é€‰)
  - `endTime` (String, å¯é€‰)
  - `page` (Integer, é»˜è®¤1)
  - `pageSize` (Integer, é»˜è®¤10)
- **è¿”å›**: `Result<Map<String, Object>>`

---

#### 3.4.8 è·å–è®¾å¤‡æœ€æ–°æ—¥å¿—
- **æ¥å£**: `GET /api/device/{deviceId}/latest-log`
- **è·¯å¾„å‚æ•°**: `deviceId` (String)
- **è¿”å›**: `Result<DeviceControlLog>`

---

#### 3.4.9 è·å–è¿è¡Œä¸­è®¾å¤‡æ•°é‡
- **æ¥å£**: `GET /api/device/running/count`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<Integer>`

---

### 3.5 ç³»ç»Ÿé…ç½®æ¥å£ (/api/config)

#### 3.5.1 è·å–æ‰€æœ‰é…ç½®
- **æ¥å£**: `GET /api/config/list`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<List<SystemConfig>>`

---

#### 3.5.2 è·å–é…ç½®å€¼
- **æ¥å£**: `GET /api/config/{key}`
- **è·¯å¾„å‚æ•°**: `key` (String)
- **è¿”å›**: `Result<String>`

---

#### 3.5.3 åˆ›å»ºé…ç½®é¡¹
- **æ¥å£**: `POST /api/config`
- **è¯·æ±‚ä½“**: `SystemConfig`
- **è¿”å›**: `Result<String>`

---

#### 3.5.4 æ›´æ–°é…ç½®é¡¹
- **æ¥å£**: `PUT /api/config/{key}`
- **è·¯å¾„å‚æ•°**: `key` (String)
- **æŸ¥è¯¢å‚æ•°**: `value` (String)
- **è¿”å›**: `Result<String>`

---

#### 3.5.5 æ‰¹é‡æ›´æ–°é…ç½®
- **æ¥å£**: `PUT /api/config/batch`
- **è¯·æ±‚ä½“**:
```json
{
  "TEMP_THRESHOLD_1": "30",
  "TEMP_THRESHOLD_2": "35",
  "HUMI_THRESHOLD_1": "80"
}
```
- **è¿”å›**: `Result<String>`

---

#### 3.5.6 è·å–å‘Šè­¦é˜ˆå€¼é…ç½®
- **æ¥å£**: `GET /api/config/alarm/thresholds`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<Map<String, Object>>`

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": {
    "TEMP_THRESHOLD_1": "30",
    "TEMP_THRESHOLD_2": "35",
    "HUMI_THRESHOLD_1": "80",
    "HUMI_THRESHOLD_2": "90",
    "NH3_THRESHOLD_1": "25",
    "NH3_THRESHOLD_2": "40",
    "H2S_THRESHOLD_1": "10",
    "H2S_THRESHOLD_2": "20"
  }
}
```

---

#### 3.5.7 åˆ·æ–°é…ç½®ç¼“å­˜
- **æ¥å£**: `POST /api/config/refresh`
- **å‚æ•°**: æ— 
- **è¿”å›**: `Result<String>`

---

## 4. å‰ç«¯ç±»å‹å®šä¹‰å‚è€ƒ

### 4.1 TypeScriptæ¥å£å®šä¹‰ (frontend/src/types/index.ts)

```typescript
// ç»Ÿä¸€å“åº”ç»“æ„
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp: number
}

// åˆ†é¡µå‚æ•°
export interface PageParams {
  pageNum: number
  pageSize: number
}

// åˆ†é¡µå“åº”
export interface PageResult<T> {
  records: T[]
  total: number
  size: number
  current: number
  pages: number
}

// ä¼ æ„Ÿå™¨æ•°æ®
export interface SensorData {
  id: number
  nodeId: string                    // âš ï¸ stringç±»å‹
  temperature: number
  humidity: number
  nh3Concentration: number          // âš ï¸ ä¸æ˜¯ammonia
  h2sConcentration: number          // âš ï¸ ä¸æ˜¯h2sæˆ–light
  dataStatus: number
  collectTime: string
  createTime: string
}

// èŠ‚ç‚¹ä¿¡æ¯
export interface NodeInfo {
  id: number
  nodeId: string                    // âš ï¸ stringç±»å‹
  nodeName: string
  location: string
  status: number                    // âš ï¸ ä¸æ˜¯nodeStatus
  batteryLevel: number
  signalStrength: number
  lastCommTime: string
  installDate: string
  remark: string
  lastOnlineTime: string
  createTime: string
  updateTime: string
}

// å‘Šè­¦ä¿¡æ¯
export interface AlarmInfo {
  id: number
  nodeId: string                    // âš ï¸ stringç±»å‹
  alarmType: string                 // âš ï¸ stringç±»å‹(TEMP/HUMI/NH3/H2S)
  alarmLevel: number
  currentValue: number              // âš ï¸ ä¸æ˜¯alarmContent
  threshold: number
  alarmTime: string
  handleStatus: number              // âš ï¸ ä¸æ˜¯alarmStatus
  handleTime?: string
  handleRemark?: string
}

// è®¾å¤‡ä¿¡æ¯
export interface DeviceInfo {
  id: number
  deviceId: string                  // âš ï¸ stringç±»å‹
  deviceName: string
  deviceType: string                // âš ï¸ stringç±»å‹(FAN/CURTAIN/HEATING/SPRAY)
  status: number                    // âš ï¸ ä¸æ˜¯deviceStatus
  autoMode: number                  // âš ï¸ æœ‰æ­¤å­—æ®µ
  controlMode: number
  createTime: string
  updateTime: string
}

// è®¾å¤‡æ§åˆ¶æ—¥å¿—
export interface DeviceControlLog {
  id: number
  deviceId: string
  controlAction: string             // âš ï¸ ä¸æ˜¯action
  controlMode: number
  operator: string
  controlTime: string               // âš ï¸ ä¸æ˜¯operateTime
  reason: string
}

// ç³»ç»Ÿé…ç½®
export interface SystemConfig {
  id: number
  configKey: string
  configValue: string
  description: string
  configType: string
  createTime: string
  updateTime: string
}

// ç»Ÿè®¡æ•°æ®
export interface Statistics {
  totalNodes: number
  onlineNodes: number
  totalDevices: number
  activeDevices: number
  totalAlarms: number
  unhandledAlarms: number
  avgTemperature: number
  avgHumidity: number
  avgNh3: number
  avgH2s: number
}
```

---

### 4.2 APIå‡½æ•°å®šä¹‰å‚è€ƒ

```typescript
// frontend/src/api/sensor.ts
export const getLatestSensorData = (nodeId?: string) => {
  return request.get<SensorData[]>('/sensor/latest', nodeId ? { nodeId } : undefined)
}

// frontend/src/api/node.ts
export const getAllNodes = () => {
  return request.get<NodeInfo[]>('/node/all')
}

export const getNodeStatusStats = () => {
  return request.get<{ online: number; offline: number; total: number }>('/node/status/stats')
}

// frontend/src/api/alarm.ts
export const getAlarmList = (params: PageParams & { 
  nodeId?: string
  alarmType?: string
  alarmLevel?: number
  handleStatus?: number        // âš ï¸ ä¸æ˜¯alarmStatus
}) => {
  return request.get<PageResult<AlarmInfo>>('/alarm/list', params)
}

export const getUnhandledAlarmCount = () => {
  return request.get<number>('/alarm/unhandled/count')
}

// frontend/src/api/device.ts
export const getAllDevices = () => {
  return request.get<DeviceInfo[]>('/device/all')
}

export const getDeviceStatusStats = () => {
  return request.get<{ online: number; offline: number; total: number }>('/device/status/stats')
}

export const controlDevice = (params: {
  deviceId: string
  action: 'START' | 'STOP'
  operator?: string
}) => {
  return request.post<void>('/device/control', params)
}

// frontend/src/api/config.ts
export const getAlarmThresholds = () => {
  return request.get<Record<string, string>>('/config/alarm/thresholds')
}
```

---

## 5. å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 å­—æ®µåä¸åŒ¹é…é”™è¯¯

âŒ **é”™è¯¯ç¤ºä¾‹**:
```typescript
// é”™è¯¯ï¼šä½¿ç”¨äº†ammoniaè€Œä¸æ˜¯nh3Concentration
const avgAmmonia = data.reduce((sum, item) => sum + item.ammonia, 0)
```

âœ… **æ­£ç¡®å†™æ³•**:
```typescript
const avgAmmonia = data.reduce((sum, item) => sum + item.nh3Concentration, 0)
```

---

### 5.2 ç±»å‹ä¸åŒ¹é…é”™è¯¯

âŒ **é”™è¯¯ç¤ºä¾‹**:
```typescript
// é”™è¯¯ï¼šnodeIdåº”è¯¥æ˜¯stringç±»å‹
const node = nodes.find(n => n.id === nodeId)  // nodeIdæ˜¯stringï¼Œn.idæ˜¯number
```

âœ… **æ­£ç¡®å†™æ³•**:
```typescript
const node = nodes.find(n => n.nodeId === nodeId)  // éƒ½æ˜¯stringç±»å‹
```

---

### 5.3 APIå‚æ•°é”™è¯¯

âŒ **é”™è¯¯ç¤ºä¾‹**:
```typescript
// é”™è¯¯ï¼šä½¿ç”¨äº†alarmStatusè€Œä¸æ˜¯handleStatus
getAlarmList({ pageNum: 1, pageSize: 10, alarmStatus: 0 })
```

âœ… **æ­£ç¡®å†™æ³•**:
```typescript
getAlarmList({ pageNum: 1, pageSize: 10, handleStatus: 0 })
```

---

## 6. é™„å½•

### 6.1 å‘Šè­¦ç±»å‹æšä¸¾

```typescript
enum AlarmType {
  TEMP = 'TEMP',      // æ¸©åº¦å‘Šè­¦
  HUMI = 'HUMI',      // æ¹¿åº¦å‘Šè­¦
  NH3 = 'NH3',        // æ°¨æ°”å‘Šè­¦
  H2S = 'H2S'         // ç¡«åŒ–æ°¢å‘Šè­¦
}
```

### 6.2 å‘Šè­¦çº§åˆ«æšä¸¾

```typescript
enum AlarmLevel {
  LOW = 1,            // ä¸€èˆ¬å‘Šè­¦
  MEDIUM = 2,         // ä¸¥é‡å‘Šè­¦
  HIGH = 3            // ç´§æ€¥å‘Šè­¦
}
```

### 6.3 è®¾å¤‡ç±»å‹æšä¸¾

```typescript
enum DeviceType {
  FAN = 'FAN',            // é£æœº
  CURTAIN = 'CURTAIN',    // å·å¸˜
  HEATING = 'HEATING',    // åŠ çƒ­
  SPRAY = 'SPRAY'         // å–·æ·‹
}
```

### 6.4 æ§åˆ¶åŠ¨ä½œæšä¸¾

```typescript
enum ControlAction {
  START = 'START',        // å¯åŠ¨
  STOP = 'STOP',          // åœæ­¢
  ADJUST = 'ADJUST'       // è°ƒèŠ‚
}
```

---

## 7. æ›´æ–°æ—¥å¿—

### v1.0 (2025-11-18)
- âœ… å®Œæ•´æ–‡æ¡£åˆæ¬¡ç”Ÿæˆ
- âœ… æ·»åŠ æ‰€æœ‰6ä¸ªå®ä½“ç±»çš„å­—æ®µæ˜ å°„
- âœ… æ·»åŠ æ‰€æœ‰5ä¸ªControllerçš„38ä¸ªAPIæ¥å£
- âœ… æ·»åŠ å‰ç«¯TypeScriptç±»å‹å®šä¹‰å‚è€ƒ
- âœ… æ·»åŠ å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ
- â­ æ–°å¢æ¥å£: `/api/node/all`, `/api/node/status/stats`, `/api/device/all`, `/api/device/status/stats`

---

**æ–‡æ¡£ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-18  
**å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒ**: `æ•°æ®åº“çœŸå®ç»“æ„æ–‡æ¡£.md`
