# WSN牛舍监测系统 - 数据库真实结构文档

数据库名: `wsn_cow_monitor`
字符集: utf8mb4
排序规则: utf8mb4_general_ci

---

## 1. alarm_record (告警记录表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | bigint | NO | PRI | NULL | auto_increment | 主键ID |
| node_id | varchar(20) | NO | MUL | NULL | | 节点ID |
| alarm_type | varchar(20) | NO | | NULL | | 告警类型 |
| alarm_level | tinyint | NO | | NULL | | 告警级别 |
| current_value | decimal(6,2) | NO | | NULL | | 当前值 |
| threshold_value | decimal(6,2) | NO | | NULL | | 阈值 |
| alarm_time | datetime | NO | MUL | NULL | | 告警时间 |
| status | tinyint | YES | MUL | 0 | | 状态(0-未处理,1-已处理) |
| handle_time | datetime | YES | | NULL | | 处理时间 |
| remark | varchar(200) | YES | | NULL | | 备注 |

**索引:**
- PRIMARY KEY: id
- KEY idx_node_id: node_id
- KEY idx_alarm_time: alarm_time
- KEY idx_status: status

---

## 2. device_control_log (设备控制日志表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | bigint | NO | PRI | NULL | auto_increment | 主键ID |
| device_id | varchar(20) | NO | MUL | NULL | | 设备ID |
| control_action | varchar(10) | NO | | NULL | | 控制动作(START/STOP) |
| control_mode | tinyint | NO | | NULL | | 控制模式(0-手动,1-自动) |
| operator | varchar(50) | YES | | NULL | | 操作人 |
| control_time | datetime | NO | MUL | NULL | | 控制时间 |
| reason | varchar(200) | YES | | NULL | | 原因/备注 |

**索引:**
- PRIMARY KEY: id
- KEY idx_device_id: device_id
- KEY idx_control_time: control_time

**注意:** 
- ❌ 数据库中**没有**`action`字段,正确字段名是`control_action`
- ❌ 数据库中**没有**`control_type`字段,正确字段名是`control_mode`
- ❌ 数据库中**没有**`operate_time`字段,正确字段名是`control_time`
- ❌ 数据库中**没有**`before_status`和`after_status`字段

---

## 3. device_info (设备信息表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | int | NO | PRI | NULL | auto_increment | 主键ID |
| device_id | varchar(20) | NO | UNI | NULL | | 设备ID(唯一) |
| device_name | varchar(50) | NO | | NULL | | 设备名称 |
| device_type | varchar(20) | NO | | NULL | | 设备类型 |
| status | tinyint | YES | | 0 | | 设备状态(0-关闭,1-运行) |
| auto_mode | int | YES | | 0 | | 自动模式(0-手动,1-自动) |
| control_mode | tinyint | YES | | 1 | | 控制模式 |
| create_time | timestamp | YES | | CURRENT_TIMESTAMP | DEFAULT_GENERATED | 创建时间 |
| update_time | timestamp | YES | | CURRENT_TIMESTAMP | on update | 更新时间 |

**索引:**
- PRIMARY KEY: id
- UNIQUE KEY: device_id

**注意:**
- ✅ `auto_mode`字段**存在**,类型为int,默认值0
- ✅ `control_mode`字段**存在**,类型为tinyint,默认值1

---

## 4. node_info (节点信息表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | int | NO | PRI | NULL | auto_increment | 主键ID |
| node_id | varchar(20) | NO | UNI | NULL | | 节点ID(唯一) |
| node_name | varchar(50) | NO | | NULL | | 节点名称 |
| location | varchar(100) | YES | | NULL | | 位置 |
| status | tinyint | YES | | 1 | | 在线状态(0-离线,1-在线) |
| battery_level | int | YES | | NULL | | 电池电量(%) |
| signal_strength | int | YES | | NULL | | 信号强度 |
| last_comm_time | datetime | YES | | NULL | | 最后通信时间 |
| install_date | date | YES | | NULL | | 安装日期 |
| remark | varchar(200) | YES | | NULL | | 备注 |
| last_online_time | datetime | YES | | NULL | | 最后在线时间 |
| create_time | timestamp | YES | | CURRENT_TIMESTAMP | DEFAULT_GENERATED | 创建时间 |
| update_time | timestamp | YES | | CURRENT_TIMESTAMP | on update | 更新时间 |

**索引:**
- PRIMARY KEY: id
- UNIQUE KEY: node_id

---

## 5. sensor_data (传感器数据表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | bigint | NO | PRI | NULL | auto_increment | 主键ID |
| node_id | varchar(20) | NO | MUL | NULL | | 节点ID |
| temperature | decimal(5,2) | NO | | NULL | | 温度(℃) |
| humidity | decimal(5,2) | NO | | NULL | | 湿度(%) |
| nh3_concentration | decimal(6,2) | NO | | NULL | | 氨气浓度(ppm) |
| h2s_concentration | decimal(6,2) | NO | | NULL | | 硫化氢浓度(ppm) |
| data_status | tinyint | YES | | 0 | | 数据状态(0-正常,1-异常) |
| collect_time | datetime | NO | MUL | NULL | | 采集时间 |
| create_time | timestamp | YES | | CURRENT_TIMESTAMP | DEFAULT_GENERATED | 创建时间 |

**索引:**
- PRIMARY KEY: id
- KEY idx_node_id: node_id
- KEY idx_collect_time: collect_time

**注意:**
- ✅ 字段名是`nh3_concentration`(带下划线)
- ✅ 字段名是`h2s_concentration`(带下划线)

---

## 6. system_config (系统配置表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | int | NO | PRI | NULL | auto_increment | 主键ID |
| config_key | varchar(50) | NO | UNI | NULL | | 配置键(唯一) |
| config_type | varchar(20) | YES | | NULL | | 配置类型 |
| config_value | varchar(200) | NO | | NULL | | 配置值 |
| description | varchar(200) | YES | | NULL | | 描述 |
| create_time | timestamp | YES | | CURRENT_TIMESTAMP | DEFAULT_GENERATED | 创建时间 |
| update_time | timestamp | YES | | CURRENT_TIMESTAMP | on update | 更新时间 |

**索引:**
- PRIMARY KEY: id
- UNIQUE KEY: config_key

---

## 7. user (用户表)

| 字段名 | 数据类型 | 是否非空 | 键 | 默认值 | 自增 | 说明 |
|--------|----------|----------|-----|--------|------|------|
| id | int | NO | PRI | NULL | auto_increment | 主键ID |
| username | varchar(50) | NO | UNI | NULL | | 用户名(唯一) |
| password | varchar(100) | NO | | NULL | | 密码 |
| real_name | varchar(50) | YES | | NULL | | 真实姓名 |
| role | varchar(20) | YES | | user | | 角色 |
| status | tinyint | YES | | 1 | | 状态(0-禁用,1-启用) |
| create_time | timestamp | YES | | CURRENT_TIMESTAMP | DEFAULT_GENERATED | 创建时间 |
| last_login_time | datetime | YES | | NULL | | 最后登录时间 |

**索引:**
- PRIMARY KEY: id
- UNIQUE KEY: username

---

## 重要提示

### 常见字段名错误对照表

| ❌ 错误字段名 | ✅ 正确字段名 | 所属表 |
|-------------|-------------|--------|
| action | control_action | device_control_log |
| control_type | control_mode | device_control_log |
| operate_time | control_time | device_control_log |
| remark | reason | device_control_log |
| before_status | 不存在 | device_control_log |
| after_status | 不存在 | device_control_log |

### 实体类命名规范

- 数据库字段使用**下划线命名**(snake_case): `control_action`, `nh3_concentration`
- Java实体类使用**驼峰命名**(camelCase): `controlAction`, `nh3Concentration`
- MyBatis自动映射或通过resultMap进行字段映射

### 日期时间字段类型

- `datetime`: 用于业务时间字段(如control_time, alarm_time)
- `timestamp`: 用于记录创建/更新时间(create_time, update_time)
- 两者在Java中都映射为`java.util.Date`类型

---

**文档生成时间:** 2025-11-18  
**数据库版本:** MySQL 8.0+
