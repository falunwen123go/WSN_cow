# ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå™¨è®¾è®¡æ–‡æ¡£

---

## ğŸ“‘ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**ï¼šWSNç‰›æ£šç¯å¢ƒç›‘æµ‹ç³»ç»Ÿ - ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå™¨
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
- **ç¼–åˆ¶æ—¥æœŸ**ï¼š2025å¹´11æœˆ19æ—¥
- **å¼€å‘è¯­è¨€**ï¼šPython 3.x

---

## ç›®å½•

1. [æ¦‚è¿°](#ä¸€æ¦‚è¿°)
2. [è®¾è®¡ç›®æ ‡](#äºŒè®¾è®¡ç›®æ ‡)
3. [ç³»ç»Ÿæ¶æ„](#ä¸‰ç³»ç»Ÿæ¶æ„)
4. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#å››æ ¸å¿ƒæ¨¡å—è®¾è®¡)
5. [æ•°æ®ç”Ÿæˆç®—æ³•](#äº”æ•°æ®ç”Ÿæˆç®—æ³•)
6. [é€šä¿¡åè®®è®¾è®¡](#å…­é€šä¿¡åè®®è®¾è®¡)
7. [é…ç½®ç®¡ç†](#ä¸ƒé…ç½®ç®¡ç†)
8. [ä½¿ç”¨è¯´æ˜](#å…«ä½¿ç”¨è¯´æ˜)
9. [æµ‹è¯•ä¸éªŒè¯](#ä¹æµ‹è¯•ä¸éªŒè¯)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 æ¨¡æ‹Ÿå™¨ç®€ä»‹

ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå™¨æ˜¯WSNç‰›æ£šç¯å¢ƒç›‘æµ‹ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç”¨äºåœ¨æ²¡æœ‰å®é™…ç¡¬ä»¶è®¾å¤‡çš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹Ÿå¤šä¸ªZigBeeä¼ æ„Ÿå™¨èŠ‚ç‚¹çš„æ•°æ®é‡‡é›†å’Œä¼ è¾“è¿‡ç¨‹ã€‚æ¨¡æ‹Ÿå™¨èƒ½å¤Ÿç”Ÿæˆç¬¦åˆçœŸå®ä¼ æ„Ÿå™¨ç‰¹æ€§çš„ç¯å¢ƒæ•°æ®ï¼Œå¹¶é€šè¿‡ç½‘ç»œé€šä¿¡å°†æ•°æ®å‘é€è‡³åç«¯æœåŠ¡å™¨ã€‚

### 1.2 åŠŸèƒ½ç‰¹ç‚¹

- âœ… **å¤šèŠ‚ç‚¹æ¨¡æ‹Ÿ**ï¼šæ”¯æŒåŒæ—¶æ¨¡æ‹Ÿ3-10ä¸ªä¼ æ„Ÿå™¨èŠ‚ç‚¹
- âœ… **çœŸå®æ•°æ®ç”Ÿæˆ**ï¼šåŸºäºå®é™…ä¼ æ„Ÿå™¨è§„æ ¼ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
- âœ… **å¤šç§æ•°æ®æ¨¡å¼**ï¼šæ­£å¸¸æ¨¡å¼ã€å¼‚å¸¸æ¨¡å¼ã€æ··åˆæ¨¡å¼
- âœ… **ZigBeeåè®®æ¨¡æ‹Ÿ**ï¼šå®Œæ•´çš„ZigBeeæ•°æ®åŒ…å°è£…å’Œè§£æ
- âœ… **Socketé€šä¿¡**ï¼šé€šè¿‡TCP Socketä¸åç«¯é€šä¿¡
- âœ… **çµæ´»é…ç½®**ï¼šYAMLé…ç½®æ–‡ä»¶ç®¡ç†æ‰€æœ‰å‚æ•°
- âœ… **æ—¥å¿—è®°å½•**ï¼šå®Œæ•´çš„è¿è¡Œæ—¥å¿—å’Œé”™è¯¯è·Ÿè¸ª

### 1.3 åº”ç”¨åœºæ™¯

- **ç³»ç»Ÿå¼€å‘é˜¶æ®µ**ï¼šæ— éœ€ç¡¬ä»¶å³å¯å¼€å‘å’Œæµ‹è¯•åç«¯æœåŠ¡
- **åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯æ•°æ®å¤„ç†ã€å‘Šè­¦ã€æ§åˆ¶ç­‰åŠŸèƒ½
- **å‹åŠ›æµ‹è¯•**ï¼šæ¨¡æ‹Ÿå¤§é‡èŠ‚ç‚¹æµ‹è¯•ç³»ç»Ÿæ€§èƒ½
- **æ¼”ç¤ºå±•ç¤º**ï¼šåœ¨æ²¡æœ‰å®é™…è®¾å¤‡æ—¶æ¼”ç¤ºç³»ç»ŸåŠŸèƒ½

---

## äºŒã€è®¾è®¡ç›®æ ‡

### 2.1 æ•°æ®çœŸå®æ€§

æ¨¡æ‹Ÿæ•°æ®åº”ç¬¦åˆå®é™…ä¼ æ„Ÿå™¨çš„ç‰¹æ€§ï¼š
- éµå¾ªä¼ æ„Ÿå™¨çš„é‡ç¨‹å’Œç²¾åº¦è§„æ ¼
- åŒ…å«åˆç†çš„éšæœºå™ªå£°
- ä½“ç°ç¯å¢ƒå‚æ•°çš„æ—¶é—´å˜åŒ–è¶‹åŠ¿
- æ¨¡æ‹Ÿæ˜¼å¤œæ¸©æ¹¿åº¦å˜åŒ–è§„å¾‹

### 2.2 åŠŸèƒ½å®Œæ•´æ€§

- æ”¯æŒ4ç§ä¼ æ„Ÿå™¨ç±»å‹ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€NHâ‚ƒã€Hâ‚‚Sï¼‰
- æ”¯æŒå¤šç§æ•°æ®æ¨¡å¼åˆ‡æ¢
- å®Œæ•´çš„ZigBeeåè®®æ ˆæ¨¡æ‹Ÿ
- å¯é çš„ç½‘ç»œé€šä¿¡æœºåˆ¶

### 2.3 å¯é…ç½®æ€§

- æ‰€æœ‰å‚æ•°é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†
- æ”¯æŒèŠ‚ç‚¹æ•°é‡åŠ¨æ€è°ƒæ•´
- æ”¯æŒé‡‡é›†å‘¨æœŸè‡ªå®šä¹‰
- æ”¯æŒæ•°æ®æ¨¡å¼å®æ—¶åˆ‡æ¢

### 2.4 å¯ç»´æŠ¤æ€§

- æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°
- å®Œå–„çš„æ—¥å¿—è®°å½•
- å‹å¥½çš„é”™è¯¯æç¤º
- ç®€æ´çš„ä»£ç ç»“æ„

---

## ä¸‰ã€ç³»ç»Ÿæ¶æ„

### 3.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  main.py (ä¸»ç¨‹åº)                    â”‚
â”‚              å¤šçº¿ç¨‹ç®¡ç† + ä¿¡å·å¤„ç†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SensorNode 1   â”‚          â”‚  SensorNode N  â”‚
    â”‚   (èŠ‚ç‚¹å®ä¾‹)     â”‚   ...    â”‚   (èŠ‚ç‚¹å®ä¾‹)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         data_generator.py (æ•°æ®ç”Ÿæˆ)          â”‚
    â”‚   æ¸©åº¦ç®—æ³• + æ¹¿åº¦ç®—æ³• + æ°”ä½“æµ“åº¦ç®—æ³•           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      zigbee_protocol.py (åè®®å°è£…)          â”‚
    â”‚   æ•°æ®åŒ…ç¼–ç  + æ ¡éªŒå’Œè®¡ç®— + JSONåºåˆ—åŒ–       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      communication.py (ç½‘ç»œé€šä¿¡)            â”‚
    â”‚   Socketè¿æ¥ + æ•°æ®å‘é€ + è‡ªåŠ¨é‡è¿          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          åç«¯æœåŠ¡å™¨ (Spring Boot)            â”‚
    â”‚   ç«¯å£ç›‘å¬ + æ•°æ®æ¥æ”¶ + æ•°æ®åº“å­˜å‚¨           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é¡¹ç›®ç»“æ„

```
sensor_simulator/
â”œâ”€â”€ __init__.py              # åŒ…åˆå§‹åŒ–
â”œâ”€â”€ main.py                  # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†æ¨¡å—
â”œâ”€â”€ config.yaml              # YAMLé…ç½®æ–‡ä»¶
â”œâ”€â”€ data_generator.py        # æ•°æ®ç”Ÿæˆæ¨¡å—
â”œâ”€â”€ zigbee_protocol.py       # ZigBeeåè®®æ¨¡æ‹Ÿ
â”œâ”€â”€ communication.py         # é€šä¿¡æ¨¡å—
â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”œâ”€â”€ README.md               # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ quick_demo.py           # å¿«é€Ÿæ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ test_all.py             # æµ‹è¯•è„šæœ¬
â””â”€â”€ logs/                   # æ—¥å¿—ç›®å½•
    â””â”€â”€ simulator.log       # è¿è¡Œæ—¥å¿—
```

### 3.3 æ¨¡å—å…³ç³»

| æ¨¡å— | ä¾èµ– | èŒè´£ |
|-----|------|------|
| main.py | config, data_generator, communication | ç¨‹åºå…¥å£ï¼ŒèŠ‚ç‚¹ç®¡ç†ï¼Œçº¿ç¨‹è°ƒåº¦ |
| config.py | yaml | é…ç½®æ–‡ä»¶è¯»å–å’Œç®¡ç† |
| data_generator.py | config | ç”ŸæˆçœŸå®æ„Ÿçš„ä¼ æ„Ÿå™¨æ•°æ® |
| zigbee_protocol.py | config | ZigBeeæ•°æ®åŒ…å°è£…å’Œè§£æ |
| communication.py | zigbee_protocol | ç½‘ç»œé€šä¿¡å’Œæ•°æ®å‘é€ |

---

## å››ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 main.py - ä¸»ç¨‹åºæ¨¡å—

#### 4.1.1 SensorNodeç±»

**åŠŸèƒ½**ï¼šè¡¨ç¤ºå•ä¸ªä¼ æ„Ÿå™¨èŠ‚ç‚¹

**å±æ€§**ï¼š
```python
- node_id: str              # èŠ‚ç‚¹IDï¼ˆå¦‚"NODE_001"ï¼‰
- location: str             # èŠ‚ç‚¹ä½ç½®ï¼ˆå¦‚"ç‰›æ£š1å·åŒºåŸŸ"ï¼‰
- enabled: bool             # æ˜¯å¦å¯ç”¨
- data_interval: int        # æ•°æ®å‘é€é—´éš”ï¼ˆç§’ï¼‰
- data_generator: SensorDataGenerator  # æ•°æ®ç”Ÿæˆå™¨
- communicator: SocketCommunicator     # é€šä¿¡å™¨
- running: bool             # è¿è¡ŒçŠ¶æ€æ ‡å¿—
- thread: Thread            # å·¥ä½œçº¿ç¨‹
```

**æ–¹æ³•**ï¼š
```python
start()                     # å¯åŠ¨èŠ‚ç‚¹ï¼ˆåˆ›å»ºçº¿ç¨‹ï¼‰
stop()                      # åœæ­¢èŠ‚ç‚¹ï¼ˆåœæ­¢çº¿ç¨‹ï¼‰
_run()                      # èŠ‚ç‚¹è¿è¡Œä¸»å¾ªç¯ï¼ˆç§æœ‰ï¼‰
```

**å·¥ä½œæµç¨‹**ï¼š
```
1. åˆå§‹åŒ–æ•°æ®ç”Ÿæˆå™¨å’Œé€šä¿¡å™¨
2. å¯åŠ¨å·¥ä½œçº¿ç¨‹
3. å¾ªç¯æ‰§è¡Œï¼š
   a. ç”Ÿæˆä¼ æ„Ÿå™¨æ•°æ®
   b. å‘é€æ•°æ®è‡³æœåŠ¡å™¨
   c. ç­‰å¾…æŒ‡å®šé—´éš”
4. æ”¶åˆ°åœæ­¢ä¿¡å·åä¼˜é›…é€€å‡º
```

#### 4.1.2 SensorSimulatorç±»

**åŠŸèƒ½**ï¼šç®¡ç†æ‰€æœ‰ä¼ æ„Ÿå™¨èŠ‚ç‚¹

**å±æ€§**ï¼š
```python
- use_mock: bool            # æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿé€šä¿¡å™¨
- nodes: List[SensorNode]   # èŠ‚ç‚¹åˆ—è¡¨
- logger: Logger            # æ—¥å¿—è®°å½•å™¨
```

**æ–¹æ³•**ï¼š
```python
initialize()                # åˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹
start()                     # å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹
stop()                      # åœæ­¢æ‰€æœ‰èŠ‚ç‚¹
_setup_logging()            # é…ç½®æ—¥å¿—ç³»ç»Ÿ
_signal_handler()           # å¤„ç†Ctrl+Cç­‰ä¿¡å·
```

**ç‰¹æ€§**ï¼š
- å¤šçº¿ç¨‹ç®¡ç†ï¼šæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œåœ¨ç‹¬ç«‹çº¿ç¨‹
- ä¿¡å·å¤„ç†ï¼šæ•è·SIGINTå’ŒSIGTERMä¿¡å·ï¼Œä¼˜é›…é€€å‡º
- æ—¥å¿—ç³»ç»Ÿï¼šç»Ÿä¸€çš„æ—¥å¿—é…ç½®å’Œè¾“å‡º

### 4.2 config.py - é…ç½®ç®¡ç†æ¨¡å—

#### 4.2.1 Configç±»

**åŠŸèƒ½**ï¼šè¯»å–å’Œç®¡ç†YAMLé…ç½®æ–‡ä»¶

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
_load_config()              # åŠ è½½YAMLé…ç½®æ–‡ä»¶
_get_default_config()       # è·å–é»˜è®¤é…ç½®
get(key, default)           # è·å–é…ç½®é¡¹ï¼ˆæ”¯æŒç‚¹å·åˆ†éš”ï¼‰
get_network_config()        # è·å–ç½‘ç»œé…ç½®
get_nodes_config()          # è·å–èŠ‚ç‚¹é…ç½®åˆ—è¡¨
get_sensor_config(type)     # è·å–æŒ‡å®šä¼ æ„Ÿå™¨é…ç½®
get_data_generation_config() # è·å–æ•°æ®ç”Ÿæˆé…ç½®
get_zigbee_config()         # è·å–ZigBeeé…ç½®
get_logging_config()        # è·å–æ—¥å¿—é…ç½®
```

**é…ç½®ç»“æ„**ï¼š
```yaml
network:                    # ç½‘ç»œé…ç½®
  coordinator_ip: "localhost"
  coordinator_port: 8888
  protocol: "socket"

nodes:                      # èŠ‚ç‚¹é…ç½®åˆ—è¡¨
  - node_id: "NODE_001"
    location: "ç‰›æ£š1å·åŒºåŸŸ"
    enabled: true
    data_interval: 60

sensors:                    # ä¼ æ„Ÿå™¨å‚æ•°
  temperature:
    range: [0, 50]
    normal_range: [15, 28]
    accuracy: 2.0
    unit: "â„ƒ"

data_generation:            # æ•°æ®ç”Ÿæˆæ¨¡å¼
  mode: "normal"            # normal/abnormal/mixed
  abnormal_probability: 0.1
  noise_level: 0.05
  trend_enabled: true

zigbee:                     # ZigBeeåè®®å‚æ•°
  pan_id: "0x1234"
  channel: 11
  coordinator_address: "0x0000"

logging:                    # æ—¥å¿—é…ç½®
  level: "INFO"
  file: "logs/simulator.log"
  console: true
```

### 4.3 data_generator.py - æ•°æ®ç”Ÿæˆæ¨¡å—

#### 4.3.1 SensorDataGeneratorç±»

**åŠŸèƒ½**ï¼šç”Ÿæˆç¬¦åˆçœŸå®ä¼ æ„Ÿå™¨ç‰¹æ€§çš„æ¨¡æ‹Ÿæ•°æ®

**å±æ€§**ï¼š
```python
- node_id: str              # èŠ‚ç‚¹ID
- mode: str                 # æ•°æ®æ¨¡å¼ï¼ˆnormal/abnormal/mixedï¼‰
- abnormal_prob: float      # å¼‚å¸¸æ¦‚ç‡ï¼ˆ0-1ï¼‰
- noise_level: float        # å™ªå£°æ°´å¹³ï¼ˆ0-1ï¼‰
- trend_enabled: bool       # æ˜¯å¦å¯ç”¨è¶‹åŠ¿å˜åŒ–
- temp_config: dict         # æ¸©åº¦ä¼ æ„Ÿå™¨é…ç½®
- hum_config: dict          # æ¹¿åº¦ä¼ æ„Ÿå™¨é…ç½®
- nh3_config: dict          # æ°¨æ°”ä¼ æ„Ÿå™¨é…ç½®
- h2s_config: dict          # ç¡«åŒ–æ°¢ä¼ æ„Ÿå™¨é…ç½®
- time_offset: float        # æ—¶é—´åç§»ï¼ˆéšæœºï¼‰
- trend_period: int         # è¶‹åŠ¿å‘¨æœŸï¼ˆç§’ï¼‰
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
generate_sensor_data()      # ç”Ÿæˆå®Œæ•´çš„ä¼ æ„Ÿå™¨æ•°æ®åŒ…
_generate_temperature(is_abnormal)   # ç”Ÿæˆæ¸©åº¦æ•°æ®
_generate_humidity(is_abnormal)      # ç”Ÿæˆæ¹¿åº¦æ•°æ®
_generate_nh3(is_abnormal)           # ç”ŸæˆNHâ‚ƒæµ“åº¦æ•°æ®
_generate_h2s(is_abnormal)           # ç”ŸæˆHâ‚‚Sæµ“åº¦æ•°æ®
_generate_battery_level()            # ç”Ÿæˆç”µæ± ç”µé‡
```

**è¾“å‡ºæ•°æ®æ ¼å¼**ï¼š
```json
{
  "node_id": "NODE_001",
  "timestamp": "2025-11-19 14:30:00",
  "temperature": 23.4,
  "humidity": 65.3,
  "nh3": 15.5,
  "h2s": 5.1,
  "battery_level": 85,
  "signal_strength": 78
}
```

### 4.4 zigbee_protocol.py - ZigBeeåè®®æ¨¡å—

#### 4.4.1 ZigBeeProtocolç±»

**åŠŸèƒ½**ï¼šæ¨¡æ‹ŸZigBeeç½‘ç»œé€šä¿¡åè®®

**å±æ€§**ï¼š
```python
- pan_id: str               # PAN IDï¼ˆå¦‚"0x1234"ï¼‰
- channel: int              # ä¿¡é“å·ï¼ˆ11-26ï¼‰
- coordinator_addr: str     # åè°ƒå™¨åœ°å€ï¼ˆå¦‚"0x0000"ï¼‰
- frame_header: str         # å¸§å¤´æ ‡è¯†ï¼ˆå¦‚"7E"ï¼‰
- checksum_enabled: bool    # æ˜¯å¦å¯ç”¨æ ¡éªŒå’Œ
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
encode_data_packet(sensor_data)  # ç¼–ç ä¸ºZigBeeæ•°æ®åŒ…
decode_data_packet(packet)       # è§£ç ZigBeeæ•°æ®åŒ…
create_json_message(sensor_data) # åˆ›å»ºJSONæ ¼å¼æ¶ˆæ¯
parse_json_message(json_msg)     # è§£æJSONæ ¼å¼æ¶ˆæ¯
_get_node_address(node_id)       # è·å–èŠ‚ç‚¹ZigBeeåœ°å€
_generate_sequence_number()      # ç”Ÿæˆåºåˆ—å·
_calculate_checksum(payload)     # è®¡ç®—æ ¡éªŒå’Œ
```

**ZigBeeæ•°æ®åŒ…ç»“æ„**ï¼š
```json
{
  "header": "7E",
  "pan_id": "0x1234",
  "source_address": "0x0001",
  "destination_address": "0x0000",
  "channel": 11,
  "sequence_number": 1,
  "payload": {
    "node_id": "NODE_001",
    "timestamp": "2025-11-19 14:30:00",
    "data": {
      "temperature": 23.4,
      "humidity": 65.3,
      "nh3": 15.5,
      "h2s": 5.1
    },
    "status": {
      "battery_level": 85,
      "signal_strength": 78
    }
  },
  "checksum": "0xA5"
}
```

### 4.5 communication.py - é€šä¿¡æ¨¡å—

#### 4.5.1 SocketCommunicatorç±»

**åŠŸèƒ½**ï¼šé€šè¿‡TCP Socketä¸åç«¯é€šä¿¡

**å±æ€§**ï¼š
```python
- host: str                 # æœåŠ¡å™¨åœ°å€
- port: int                 # æœåŠ¡å™¨ç«¯å£
- protocol: ZigBeeProtocol  # ZigBeeåè®®å¤„ç†å™¨
- socket: socket.socket     # Socketå¯¹è±¡
- connected: bool           # è¿æ¥çŠ¶æ€
- logger: Logger            # æ—¥å¿—è®°å½•å™¨
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
connect(retry_count, retry_interval)  # è¿æ¥æœåŠ¡å™¨ï¼ˆæ”¯æŒé‡è¯•ï¼‰
send_data(sensor_data)                # å‘é€ä¼ æ„Ÿå™¨æ•°æ®
receive_response(timeout)             # æ¥æ”¶æœåŠ¡å™¨å“åº”
disconnect()                          # æ–­å¼€è¿æ¥
is_connected()                        # æ£€æŸ¥è¿æ¥çŠ¶æ€
reconnect()                           # é‡æ–°è¿æ¥
```

**é€šä¿¡æµç¨‹**ï¼š
```
1. åˆ›å»ºTCP Socketè¿æ¥
2. å°†ä¼ æ„Ÿå™¨æ•°æ®ç¼–ç ä¸ºZigBee JSONæ¶ˆæ¯
3. æ·»åŠ æ¢è¡Œç¬¦ä½œä¸ºæ¶ˆæ¯åˆ†éš”ç¬¦
4. å‘é€è‡³æœåŠ¡å™¨
5. ï¼ˆå¯é€‰ï¼‰æ¥æ”¶æœåŠ¡å™¨å“åº”
6. è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
```

#### 4.5.2 MockCommunicatorç±»

**åŠŸèƒ½**ï¼šæ¨¡æ‹Ÿé€šä¿¡å™¨ï¼ˆç”¨äºæµ‹è¯•ï¼‰

**ç‰¹ç‚¹**ï¼š
- ä¸éœ€è¦çœŸå®çš„ç½‘ç»œè¿æ¥
- å°†å‘é€çš„æ•°æ®è¾“å‡ºåˆ°æ—¥å¿—
- ç«‹å³è¿”å›æˆåŠŸçŠ¶æ€
- é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•é˜¶æ®µ

---

## äº”ã€æ•°æ®ç”Ÿæˆç®—æ³•

### 5.1 æ¸©åº¦æ•°æ®ç”Ÿæˆ

#### 5.1.1 æ­£å¸¸æ¨¡å¼ç®—æ³•

```python
# 1. ç¡®å®šä¸­å¿ƒå€¼å’ŒæŒ¯å¹…
center = (temp_range[0] + temp_range[1]) / 2  # ä¸­å¿ƒæ¸©åº¦
amplitude = (temp_range[1] - temp_range[0]) / 2  # æŒ¯å¹…

# 2. æ·»åŠ è¶‹åŠ¿å˜åŒ–ï¼ˆæ¨¡æ‹Ÿæ˜¼å¤œæ¸©å·®ï¼‰
trend = amplitude * 0.5 * sin(2Ï€ * time / period + offset)

# 3. è®¡ç®—åŸºå‡†å€¼
base_value = center + trend

# 4. æ·»åŠ é«˜æ–¯å™ªå£°
noise = gaussian(0, accuracy * noise_level)

# 5. æœ€ç»ˆå€¼
temperature = clip(base_value + noise, range_min, range_max)
```

**å‚æ•°è¯´æ˜**ï¼š
- `temp_range`ï¼šæ¸©åº¦é‡ç¨‹ï¼Œå¦‚[0, 50]â„ƒ
- `period`ï¼šè¶‹åŠ¿å‘¨æœŸï¼Œé»˜è®¤3600ç§’ï¼ˆ1å°æ—¶ï¼‰
- `offset`ï¼šéšæœºæ—¶é—´åç§»ï¼Œé¿å…æ‰€æœ‰èŠ‚ç‚¹åŒæ­¥
- `accuracy`ï¼šä¼ æ„Ÿå™¨ç²¾åº¦ï¼Œå¦‚Â±2â„ƒ
- `noise_level`ï¼šå™ªå£°ç³»æ•°ï¼Œå¦‚0.05ï¼ˆ5%ï¼‰

#### 5.1.2 å¼‚å¸¸æ¨¡å¼ç®—æ³•

```python
if random() < 0.5:
    # 50%æ¦‚ç‡ç”Ÿæˆè¿‡ä½æ¸©åº¦
    base_value = uniform(0, 10)  # 0-10â„ƒ
else:
    # 50%æ¦‚ç‡ç”Ÿæˆè¿‡é«˜æ¸©åº¦
    base_value = uniform(35, 45)  # 35-45â„ƒ

# æ·»åŠ å™ªå£°
temperature = base_value + gaussian(0, accuracy * noise_level)
```

### 5.2 æ¹¿åº¦æ•°æ®ç”Ÿæˆ

#### 5.2.1 æ­£å¸¸æ¨¡å¼ç®—æ³•

```python
# æ¹¿åº¦ä¸æ¸©åº¦å‘ˆè´Ÿç›¸å…³
center = (hum_range[0] + hum_range[1]) / 2
amplitude = (hum_range[1] - hum_range[0]) / 2

# è¶‹åŠ¿ä¸æ¸©åº¦ç›¸å
trend = -amplitude * 0.4 * sin(2Ï€ * time / period + offset)

base_value = center + trend
noise = gaussian(0, accuracy * noise_level)

humidity = clip(base_value + noise, range_min, range_max)
```

### 5.3 æ°”ä½“æµ“åº¦ç”Ÿæˆ

#### 5.3.1 NHâ‚ƒæµ“åº¦ - æ­£å¸¸æ¨¡å¼

```python
# åœ¨æ­£å¸¸èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒ
normal_range = [5, 15]  # ppm
base_value = uniform(normal_range[0], normal_range[1])

# æ·»åŠ å™ªå£°
noise = gaussian(0, accuracy * noise_level)

nh3 = clip(base_value + noise, 0, 100)
```

#### 5.3.2 NHâ‚ƒæµ“åº¦ - å¼‚å¸¸æ¨¡å¼

```python
alarm_level_1 = 25  # ä¸€çº§è­¦å‘Šé˜ˆå€¼
alarm_level_2 = 40  # äºŒçº§è­¦å‘Šé˜ˆå€¼

if random() < 0.3:
    # 30%æ¦‚ç‡è¾¾åˆ°äºŒçº§è­¦å‘Š
    base_value = uniform(alarm_level_2, alarm_level_2 + 15)
else:
    # 70%æ¦‚ç‡è¾¾åˆ°ä¸€çº§è­¦å‘Š
    base_value = uniform(alarm_level_1, alarm_level_2)

nh3 = base_value + gaussian(0, accuracy * noise_level)
```

#### 5.3.3 Hâ‚‚Sæµ“åº¦ç”Ÿæˆ

ç®—æ³•ç±»ä¼¼NHâ‚ƒï¼Œä½†é˜ˆå€¼ä¸åŒï¼š
- ä¸€çº§è­¦å‘Šï¼š10 ppm
- äºŒçº§è­¦å‘Šï¼š20 ppm

### 5.4 ç”µæ± ç”µé‡ç”Ÿæˆ

```python
# æ¨¡æ‹Ÿç”µæ± ç¼“æ…¢æ”¾ç”µ
base_level = 100 - (time % 86400) / 86400 * 5  # æ¯å¤©å‡å°‘5%
noise = uniform(-2, 2)
battery_level = clip(base_level + noise, 0, 100)
```

### 5.5 ä¿¡å·å¼ºåº¦ç”Ÿæˆ

```python
# åœ¨60-100èŒƒå›´å†…éšæœºæ³¢åŠ¨
signal_strength = random_int(60, 100)
```

---

## å…­ã€é€šä¿¡åè®®è®¾è®¡

### 6.1 ZigBeeåè®®æ ˆæ¨¡æ‹Ÿ

è™½ç„¶æ¨¡æ‹Ÿå™¨ä½¿ç”¨TCP Socketé€šä¿¡è€ŒéçœŸå®çš„ZigBeeæ— çº¿é€šä¿¡ï¼Œä½†æ•°æ®åŒ…æ ¼å¼å®Œå…¨æŒ‰ç…§ZigBeeåè®®ç»“æ„è®¾è®¡ã€‚

#### 6.1.1 åè®®å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Layer (åº”ç”¨å±‚)      â”‚  â† JSONæ ¼å¼çš„ä¼ æ„Ÿå™¨æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Network Layer (ç½‘ç»œå±‚)          â”‚  â† ZigBeeæ•°æ®åŒ…å°è£…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MAC Layer (MACå±‚)              â”‚  â† åœ°å€ã€åºåˆ—å·ã€æ ¡éªŒå’Œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Physical Layer (ç‰©ç†å±‚)         â”‚  â† TCP Socketä¼ è¾“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.2 æ•°æ®åŒ…å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|------|
| header | string | å¸§å¤´æ ‡è¯† | "7E" |
| pan_id | string | ä¸ªåŸŸç½‘ID | "0x1234" |
| source_address | string | æºèŠ‚ç‚¹åœ°å€ | "0x0001" |
| destination_address | string | ç›®æ ‡åœ°å€ï¼ˆåè°ƒå™¨ï¼‰ | "0x0000" |
| channel | int | é€šä¿¡ä¿¡é“ | 11 |
| sequence_number | int | åºåˆ—å·ï¼ˆ0-255å¾ªç¯ï¼‰ | 1 |
| payload | object | æ•°æ®è´Ÿè½½ | {...} |
| checksum | string | æ ¡éªŒå’Œ | "0xA5" |

### 6.2 æ ¡éªŒå’Œè®¡ç®—

#### 6.2.1 ç®—æ³•æè¿°

```python
def calculate_checksum(payload):
    """
    ç®€å•8ä½æ ¡éªŒå’Œç®—æ³•
    
    æ­¥éª¤ï¼š
    1. å°†payloadè½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
    2. éå†æ¯ä¸ªå­—ç¬¦ï¼Œç´¯åŠ ASCIIç 
    3. å¯¹256å–æ¨¡ï¼Œå¾—åˆ°8ä½æ ¡éªŒå’Œ
    4. å–ååŠ 1ï¼ˆè¡¥ç ï¼‰
    5. è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²
    """
    payload_str = json.dumps(payload, sort_keys=True)
    checksum = 0
    for char in payload_str:
        checksum = (checksum + ord(char)) & 0xFF
    checksum = (~checksum + 1) & 0xFF
    return f"0x{checksum:02X}"
```

#### 6.2.2 æ ¡éªŒæµç¨‹

**å‘é€ç«¯**ï¼š
```
1. æ„é€ payloadæ•°æ®
2. è®¡ç®—checksum
3. æ·»åŠ åˆ°æ•°æ®åŒ…
4. åºåˆ—åŒ–ä¸ºJSON
5. é€šè¿‡Socketå‘é€
```

**æ¥æ”¶ç«¯**ï¼š
```
1. æ¥æ”¶JSONæ•°æ®
2. è§£æä¸ºæ•°æ®åŒ…å¯¹è±¡
3. æå–payload
4. é‡æ–°è®¡ç®—checksum
5. ä¸æ•°æ®åŒ…ä¸­çš„checksumå¯¹æ¯”
6. ä¸€è‡´åˆ™æ¥å—ï¼Œå¦åˆ™ä¸¢å¼ƒ
```

### 6.3 æ¶ˆæ¯æ ¼å¼

#### 6.3.1 å®Œæ•´æ¶ˆæ¯ç¤ºä¾‹

```json
{
  "header": "7E",
  "pan_id": "0x1234",
  "source_address": "0x0001",
  "destination_address": "0x0000",
  "channel": 11,
  "sequence_number": 1,
  "payload": {
    "node_id": "NODE_001",
    "timestamp": "2025-11-19 14:30:00",
    "data": {
      "temperature": 23.4,
      "humidity": 65.3,
      "nh3": 15.5,
      "h2s": 5.1
    },
    "status": {
      "battery_level": 85,
      "signal_strength": 78
    }
  },
  "checksum": "0xA5"
}
```

#### 6.3.2 æ¶ˆæ¯åˆ†éš”

ç”±äºTCPæ˜¯æµå¼åè®®ï¼Œéœ€è¦æ˜ç¡®çš„æ¶ˆæ¯è¾¹ç•Œï¼š

```python
# å‘é€ç«¯æ·»åŠ æ¢è¡Œç¬¦ä½œä¸ºåˆ†éš”ç¬¦
message = json_string + '\n'
socket.sendall(message.encode('utf-8'))

# æ¥æ”¶ç«¯æŒ‰è¡Œè¯»å–
while True:
    line = socket_file.readline()
    if line:
        process_message(line)
```

---

## ä¸ƒã€é…ç½®ç®¡ç†

### 7.1 é…ç½®æ–‡ä»¶ç»“æ„

#### 7.1.1 config.yamlå®Œæ•´ç¤ºä¾‹

```yaml
# ç½‘ç»œé…ç½®
network:
  coordinator_ip: "localhost"    # åç«¯æœåŠ¡å™¨IP
  coordinator_port: 8888         # åç«¯æœåŠ¡å™¨ç«¯å£
  protocol: "socket"             # é€šä¿¡åè®®ï¼ˆsocket/serialï¼‰

# ä¼ æ„Ÿå™¨èŠ‚ç‚¹é…ç½®
nodes:
  - node_id: "NODE_001"          # èŠ‚ç‚¹ID
    location: "ç‰›æ£š1å·åŒºåŸŸ"       # èŠ‚ç‚¹ä½ç½®
    enabled: true                # æ˜¯å¦å¯ç”¨
    data_interval: 60            # æ•°æ®å‘é€é—´éš”ï¼ˆç§’ï¼‰
    
  - node_id: "NODE_002"
    location: "ç‰›æ£š2å·åŒºåŸŸ"
    enabled: true
    data_interval: 60
    
  - node_id: "NODE_003"
    location: "ç‰›æ£š3å·åŒºåŸŸ"
    enabled: true
    data_interval: 60

# ä¼ æ„Ÿå™¨å‚æ•°é…ç½®
sensors:
  temperature:
    range: [0, 50]               # æ¸©åº¦é‡ç¨‹ï¼ˆâ„ƒï¼‰
    normal_range: [15, 28]       # æ­£å¸¸èŒƒå›´
    accuracy: 2.0                # ç²¾åº¦ï¼ˆÂ±â„ƒï¼‰
    unit: "â„ƒ"
    
  humidity:
    range: [20, 95]              # æ¹¿åº¦é‡ç¨‹ï¼ˆ%RHï¼‰
    normal_range: [50, 75]       # æ­£å¸¸èŒƒå›´
    accuracy: 5.0                # ç²¾åº¦ï¼ˆÂ±%ï¼‰
    unit: "%RH"
    
  nh3:
    range: [0, 100]              # æ°¨æ°”é‡ç¨‹ï¼ˆppmï¼‰
    normal_range: [5, 15]        # æ­£å¸¸èŒƒå›´
    alarm_level_1: 25            # ä¸€çº§è­¦å‘Šé˜ˆå€¼
    alarm_level_2: 40            # äºŒçº§è­¦å‘Šé˜ˆå€¼
    accuracy: 1.0                # ç²¾åº¦ï¼ˆÂ±ppmï¼‰
    unit: "ppm"
    
  h2s:
    range: [0, 50]               # ç¡«åŒ–æ°¢é‡ç¨‹ï¼ˆppmï¼‰
    normal_range: [0, 5]         # æ­£å¸¸èŒƒå›´
    alarm_level_1: 10            # ä¸€çº§è­¦å‘Šé˜ˆå€¼
    alarm_level_2: 20            # äºŒçº§è­¦å‘Šé˜ˆå€¼
    accuracy: 0.5                # ç²¾åº¦ï¼ˆÂ±ppmï¼‰
    unit: "ppm"

# æ•°æ®ç”Ÿæˆæ¨¡å¼
data_generation:
  mode: "normal"                 # normalï¼ˆæ­£å¸¸ï¼‰, abnormalï¼ˆå¼‚å¸¸ï¼‰, mixedï¼ˆæ··åˆï¼‰
  abnormal_probability: 0.1      # å¼‚å¸¸æ•°æ®æ¦‚ç‡ï¼ˆä»…åœ¨mixedæ¨¡å¼ä¸‹ï¼‰
  noise_level: 0.05              # å™ªå£°æ°´å¹³ï¼ˆ0-1ï¼‰
  trend_enabled: true            # æ˜¯å¦å¯ç”¨è¶‹åŠ¿å˜åŒ–
  
# ZigBeeåè®®æ¨¡æ‹Ÿ
zigbee:
  pan_id: "0x1234"               # PAN ID
  channel: 11                    # ä¿¡é“ï¼ˆ11-26ï¼‰
  coordinator_address: "0x0000"  # åè°ƒå™¨åœ°å€
  frame_header: "7E"             # å¸§å¤´
  checksum_enabled: true         # æ˜¯å¦å¯ç”¨æ ¡éªŒå’Œ
  
# æ—¥å¿—é…ç½®
logging:
  level: "INFO"                  # DEBUG, INFO, WARNING, ERROR
  file: "logs/simulator.log"     # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  console: true                  # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°
```

### 7.2 é…ç½®é¡¹è¯´æ˜

#### 7.2.1 ç½‘ç»œé…ç½®

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| coordinator_ip | string | "localhost" | åç«¯æœåŠ¡å™¨IPåœ°å€ |
| coordinator_port | int | 8888 | åç«¯æœåŠ¡å™¨ç«¯å£å· |
| protocol | string | "socket" | é€šä¿¡åè®®ç±»å‹ |

#### 7.2.2 èŠ‚ç‚¹é…ç½®

æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-----|------|-----|------|
| node_id | string | âœ… | èŠ‚ç‚¹å”¯ä¸€æ ‡è¯† |
| location | string | âœ… | èŠ‚ç‚¹å®‰è£…ä½ç½® |
| enabled | boolean | âœ… | æ˜¯å¦å¯ç”¨è¯¥èŠ‚ç‚¹ |
| data_interval | int | âœ… | æ•°æ®å‘é€é—´éš”ï¼ˆç§’ï¼‰ |

#### 7.2.3 ä¼ æ„Ÿå™¨é…ç½®

æ¯ç§ä¼ æ„Ÿå™¨åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| range | array | ä¼ æ„Ÿå™¨é‡ç¨‹ [æœ€å°å€¼, æœ€å¤§å€¼] |
| normal_range | array | æ­£å¸¸å·¥ä½œèŒƒå›´ |
| accuracy | float | ä¼ æ„Ÿå™¨ç²¾åº¦ï¼ˆÂ±å€¼ï¼‰ |
| alarm_level_1 | float | ä¸€çº§è­¦å‘Šé˜ˆå€¼ï¼ˆä»…æ°”ä½“ï¼‰ |
| alarm_level_2 | float | äºŒçº§è­¦å‘Šé˜ˆå€¼ï¼ˆä»…æ°”ä½“ï¼‰ |
| unit | string | æµ‹é‡å•ä½ |

#### 7.2.4 æ•°æ®ç”Ÿæˆé…ç½®

| å‚æ•° | ç±»å‹ | å–å€¼ | è¯´æ˜ |
|-----|------|-----|------|
| mode | string | normal/abnormal/mixed | æ•°æ®ç”Ÿæˆæ¨¡å¼ |
| abnormal_probability | float | 0-1 | å¼‚å¸¸æ¦‚ç‡ï¼ˆæ··åˆæ¨¡å¼ï¼‰ |
| noise_level | float | 0-1 | å™ªå£°æ°´å¹³ |
| trend_enabled | boolean | true/false | æ˜¯å¦å¯ç”¨è¶‹åŠ¿ |

### 7.3 è¿è¡Œæ—¶é…ç½®

#### 7.3.1 å‘½ä»¤è¡Œå‚æ•°

```bash
# æµ‹è¯•æ¨¡å¼ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿé€šä¿¡å™¨ï¼‰
python main.py --mock

# æŒ‡å®šé…ç½®æ–‡ä»¶
python main.py --config custom_config.yaml

# ç»„åˆä½¿ç”¨
python main.py --mock --config test_config.yaml
```

#### 7.3.2 ç¯å¢ƒå˜é‡ï¼ˆå¯æ‰©å±•ï¼‰

```bash
# è®¾ç½®æœåŠ¡å™¨åœ°å€
export COORDINATOR_IP=192.168.1.100
export COORDINATOR_PORT=9090

# è®¾ç½®æ—¥å¿—çº§åˆ«
export LOG_LEVEL=DEBUG
```

---

## å…«ã€ä½¿ç”¨è¯´æ˜

### 8.1 ç¯å¢ƒå‡†å¤‡

#### 8.1.1 å®‰è£…Python

ç¡®ä¿å®‰è£…Python 3.7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š

```bash
python --version
# è¾“å‡ºï¼šPython 3.x.x
```

#### 8.1.2 å®‰è£…ä¾èµ–

```bash
cd sensor_simulator
pip install -r requirements.txt
```

**ä¾èµ–åŒ…åˆ—è¡¨**ï¼ˆrequirements.txtï¼‰ï¼š
```
PyYAML>=6.0
```

### 8.2 é…ç½®ä¿®æ”¹

#### 8.2.1 ä¿®æ”¹æœåŠ¡å™¨åœ°å€

ç¼–è¾‘`config.yaml`ï¼š

```yaml
network:
  coordinator_ip: "192.168.1.100"  # ä¿®æ”¹ä¸ºå®é™…æœåŠ¡å™¨IP
  coordinator_port: 8888            # ä¿®æ”¹ä¸ºå®é™…ç«¯å£
```

#### 8.2.2 ä¿®æ”¹èŠ‚ç‚¹æ•°é‡

åœ¨`config.yaml`ä¸­æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼š

```yaml
nodes:
  - node_id: "NODE_004"
    location: "ç‰›æ£š4å·åŒºåŸŸ"
    enabled: true
    data_interval: 60
```

#### 8.2.3 åˆ‡æ¢æ•°æ®æ¨¡å¼

```yaml
data_generation:
  mode: "abnormal"  # æ”¹ä¸ºå¼‚å¸¸æ¨¡å¼
```

### 8.3 è¿è¡Œæ¨¡æ‹Ÿå™¨

#### 8.3.1 æµ‹è¯•æ¨¡å¼è¿è¡Œ

é€‚ç”¨äºå¼€å‘é˜¶æ®µï¼Œä¸éœ€è¦åç«¯æœåŠ¡å™¨ï¼š

```bash
python main.py --mock
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
2025-11-19 14:30:00 - SensorSimulator - INFO - === ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå™¨å¯åŠ¨ ===
2025-11-19 14:30:00 - SensorSimulator - INFO - è¿è¡Œæ¨¡å¼: æµ‹è¯•æ¨¡å¼ï¼ˆæ¨¡æ‹Ÿé€šä¿¡ï¼‰
2025-11-19 14:30:00 - SensorNode-NODE_001 - INFO - èŠ‚ç‚¹ NODE_001 (ç‰›æ£š1å·åŒºåŸŸ) å·²å¯åŠ¨
2025-11-19 14:30:00 - MockCommunicator - INFO - [æ¨¡æ‹Ÿå‘é€] èŠ‚ç‚¹=NODE_001, æ¸©åº¦=23.4â„ƒ, æ¹¿åº¦=65.3%
```

#### 8.3.2 ç”Ÿäº§æ¨¡å¼è¿è¡Œ

è¿æ¥çœŸå®çš„åç«¯æœåŠ¡å™¨ï¼š

```bash
python main.py
```

#### 8.3.3 åœæ­¢æ¨¡æ‹Ÿå™¨

æŒ‰`Ctrl+C`æˆ–å‘é€SIGTERMä¿¡å·ï¼š

```
^C
2025-11-19 14:35:00 - SensorSimulator - INFO - æ”¶åˆ°åœæ­¢ä¿¡å·...
2025-11-19 14:35:00 - SensorNode-NODE_001 - INFO - èŠ‚ç‚¹ NODE_001 å·²åœæ­¢
2025-11-19 14:35:00 - SensorSimulator - INFO - === ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå™¨å·²åœæ­¢ ===
```

### 8.4 æ—¥å¿—æŸ¥çœ‹

#### 8.4.1 å®æ—¶æŸ¥çœ‹æ—¥å¿—

```bash
tail -f logs/simulator.log
```

#### 8.4.2 æ—¥å¿—çº§åˆ«

- **DEBUG**ï¼šè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- **INFO**ï¼šä¸€èˆ¬è¿è¡Œä¿¡æ¯
- **WARNING**ï¼šè­¦å‘Šä¿¡æ¯
- **ERROR**ï¼šé”™è¯¯ä¿¡æ¯

ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼š

```yaml
logging:
  level: "DEBUG"  # æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¥å¿—
```

---

## ä¹ã€æµ‹è¯•ä¸éªŒè¯

### 9.1 å•å…ƒæµ‹è¯•

#### 9.1.1 æµ‹è¯•é…ç½®è¯»å–

```bash
python config.py
```

é¢„æœŸè¾“å‡ºï¼š
```
ç½‘ç»œé…ç½®: {'coordinator_ip': 'localhost', 'coordinator_port': 8888, ...}
èŠ‚ç‚¹é…ç½®: [{'node_id': 'NODE_001', 'location': 'ç‰›æ£š1å·åŒºåŸŸ', ...}]
```

#### 9.1.2 æµ‹è¯•æ•°æ®ç”Ÿæˆ

```bash
python data_generator.py
```

é¢„æœŸè¾“å‡ºï¼š
```
=== æ­£å¸¸æ¨¡å¼æ•°æ® ===
æ ·æœ¬ 1: æ¸©åº¦=22.3â„ƒ, æ¹¿åº¦=64.1%, NH3=12.3ppm, H2S=3.1ppm
æ ·æœ¬ 2: æ¸©åº¦=23.7â„ƒ, æ¹¿åº¦=66.8%, NH3=13.9ppm, H2S=4.2ppm
...

=== å¼‚å¸¸æ¨¡å¼æ•°æ® ===
æ ·æœ¬ 1: æ¸©åº¦=42.1â„ƒ, æ¹¿åº¦=88.3%, NH3=38.7ppm, H2S=18.9ppm
...
```

#### 9.1.3 æµ‹è¯•ZigBeeåè®®

```bash
python zigbee_protocol.py
```

é¢„æœŸè¾“å‡ºï¼š
```
=== åŸå§‹ä¼ æ„Ÿå™¨æ•°æ® ===
{
  "node_id": "NODE_001",
  "temperature": 22.5,
  ...
}

=== ç¼–ç ä¸ºZigBeeæ•°æ®åŒ… ===
{
  "header": "7E",
  "pan_id": "0x1234",
  ...
}

=== éªŒè¯æ•°æ®ä¸€è‡´æ€§ ===
æ¸©åº¦ä¸€è‡´: True
æ¹¿åº¦ä¸€è‡´: True
```

#### 9.1.4 æµ‹è¯•é€šä¿¡æ¨¡å—

```bash
python communication.py
```

### 9.2 é›†æˆæµ‹è¯•

#### 9.2.1 å®Œæ•´æµç¨‹æµ‹è¯•

```bash
# 1. å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
python main.py --mock

# 2. è§‚å¯Ÿæ—¥å¿—è¾“å‡º
# 3. éªŒè¯æ•°æ®æ ¼å¼
# 4. åœæ­¢æ¨¡æ‹Ÿå™¨ï¼ˆCtrl+Cï¼‰
```

#### 9.2.2 ä¸åç«¯è”è°ƒæµ‹è¯•

```bash
# 1. ç¡®ä¿åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨8888ç«¯å£
# 2. å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
python main.py

# 3. åœ¨åç«¯æŸ¥çœ‹æ˜¯å¦æ¥æ”¶åˆ°æ•°æ®
# 4. åœ¨æ•°æ®åº“éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®å­˜å‚¨
```

### 9.3 æ€§èƒ½æµ‹è¯•

#### 9.3.1 å¤šèŠ‚ç‚¹å¹¶å‘æµ‹è¯•

ä¿®æ”¹`config.yaml`ï¼Œå¢åŠ èŠ‚ç‚¹æ•°é‡è‡³10ä¸ªï¼š

```yaml
nodes:
  - node_id: "NODE_001"
    ...
  - node_id: "NODE_010"
    ...
```

è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼Œè§‚å¯ŸCPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚

#### 9.3.2 é«˜é¢‘æ•°æ®æµ‹è¯•

ä¿®æ”¹æ•°æ®å‘é€é—´éš”ï¼š

```yaml
nodes:
  - node_id: "NODE_001"
    data_interval: 5  # æ”¹ä¸º5ç§’
```

### 9.4 å¼‚å¸¸æµ‹è¯•

#### 9.4.1 ç½‘ç»œæ–­å¼€æµ‹è¯•

```bash
# 1. å¯åŠ¨æ¨¡æ‹Ÿå™¨
python main.py

# 2. åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åœæ­¢åç«¯æœåŠ¡å™¨
# 3. è§‚å¯Ÿæ¨¡æ‹Ÿå™¨çš„é‡è¿è¡Œä¸º
# 4. é‡å¯åç«¯æœåŠ¡å™¨
# 5. éªŒè¯æ¨¡æ‹Ÿå™¨æ˜¯å¦è‡ªåŠ¨é‡è¿æˆåŠŸ
```

#### 9.4.2 é…ç½®é”™è¯¯æµ‹è¯•

```bash
# 1. æ•…æ„ä¿®æ”¹config.yamlä¸­çš„é”™è¯¯é…ç½®
# 2. å¯åŠ¨æ¨¡æ‹Ÿå™¨
# 3. éªŒè¯æ˜¯å¦æœ‰å‹å¥½çš„é”™è¯¯æç¤º
# 4. éªŒè¯æ˜¯å¦ä½¿ç”¨é»˜è®¤é…ç½®ç»§ç»­è¿è¡Œ
```

---

## åã€å¸¸è§é—®é¢˜

### 10.1 è¿æ¥é—®é¢˜

**Q1: æç¤º"è¿æ¥å¤±è´¥"**

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. åç«¯æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
2. IPåœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
3. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢è¿æ¥
4. ç½‘ç»œæ˜¯å¦ç•…é€š

**Q2: è¿æ¥æˆåŠŸä½†æ•°æ®æœªæ˜¾ç¤º**

**A**: 
1. æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æ¥æ”¶åˆ°æ•°æ®
2. æ£€æŸ¥æ•°æ®åŒ…æ ¼å¼æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æ­£å¸¸å­˜å‚¨

### 10.2 æ•°æ®é—®é¢˜

**Q3: æ•°æ®å…¨æ˜¯å¼‚å¸¸å€¼**

**A**: æ£€æŸ¥`config.yaml`ä¸­çš„`mode`è®¾ç½®ï¼š
```yaml
data_generation:
  mode: "normal"  # æ”¹ä¸ºnormalæ¨¡å¼
```

**Q4: æ•°æ®å˜åŒ–ä¸æ˜æ˜¾**

**A**: è°ƒæ•´å™ªå£°æ°´å¹³å’Œè¶‹åŠ¿å¼€å…³ï¼š
```yaml
data_generation:
  noise_level: 0.1      # å¢åŠ å™ªå£°
  trend_enabled: true   # å¯ç”¨è¶‹åŠ¿
```

### 10.3 æ€§èƒ½é—®é¢˜

**Q5: CPUå ç”¨è¿‡é«˜**

**A**: 
1. å‡å°‘èŠ‚ç‚¹æ•°é‡
2. å¢å¤§æ•°æ®å‘é€é—´éš”
3. æ£€æŸ¥æ—¥å¿—çº§åˆ«ï¼ˆDEBUGçº§åˆ«ä¼šå¢åŠ å¼€é”€ï¼‰

**Q6: å†…å­˜å ç”¨æŒç»­å¢é•¿**

**A**: å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œè¯·æ£€æŸ¥ï¼š
1. Socketè¿æ¥æ˜¯å¦æ­£ç¡®å…³é—­
2. çº¿ç¨‹æ˜¯å¦æ­£ç¡®é€€å‡º
3. æ—¥å¿—æ–‡ä»¶æ˜¯å¦è¿‡å¤§

### 10.4 é…ç½®é—®é¢˜

**Q7: ä¿®æ”¹é…ç½®ä¸ç”Ÿæ•ˆ**

**A**: 
1. ç¡®è®¤ä¿®æ”¹çš„æ˜¯æ­£ç¡®çš„é…ç½®æ–‡ä»¶
2. é‡å¯æ¨¡æ‹Ÿå™¨
3. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆYAMLè¯­æ³•ï¼‰

---

## åä¸€ã€æ‰©å±•ä¸ä¼˜åŒ–

### 11.1 å·²å®ç°åŠŸèƒ½

- âœ… å¤šèŠ‚ç‚¹å¹¶å‘æ¨¡æ‹Ÿ
- âœ… ä¸‰ç§æ•°æ®æ¨¡å¼
- âœ… ZigBeeåè®®å°è£…
- âœ… Socketé€šä¿¡
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… æ—¥å¿—ç³»ç»Ÿ
- âœ… YAMLé…ç½®ç®¡ç†

### 11.2 å¯æ‰©å±•åŠŸèƒ½

- â¬œ **ä¸²å£é€šä¿¡**ï¼šæ”¯æŒçœŸå®çš„ä¸²å£è®¾å¤‡
- â¬œ **æ›´å¤šä¼ æ„Ÿå™¨ç±»å‹**ï¼šCOâ‚‚ã€å…‰ç…§ã€å™ªéŸ³ç­‰
- â¬œ **æ•°æ®å¯è§†åŒ–**ï¼šå®æ—¶æ˜¾ç¤ºç”Ÿæˆçš„æ•°æ®æ›²çº¿
- â¬œ **æ‰¹é‡æ•°æ®å¯¼å…¥**ï¼šä»CSVæ–‡ä»¶å¯¼å…¥å†å²æ•°æ®
- â¬œ **æ•…éšœåœºæ™¯æ¨¡æ‹Ÿ**ï¼šæ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•…éšœã€é€šä¿¡ä¸­æ–­ç­‰
- â¬œ **RESTful API**ï¼šæä¾›HTTPæ¥å£æ§åˆ¶æ¨¡æ‹Ÿå™¨
- â¬œ **Webç®¡ç†ç•Œé¢**ï¼šé€šè¿‡æµè§ˆå™¨ç®¡ç†æ¨¡æ‹Ÿå™¨

### 11.3 æ€§èƒ½ä¼˜åŒ–

- â¬œ **æ•°æ®ç¼“å­˜**ï¼šæ‰¹é‡å‘é€æ•°æ®å‡å°‘ç½‘ç»œå¼€é”€
- â¬œ **è¿æ¥æ± **ï¼šå¤ç”¨Socketè¿æ¥
- â¬œ **å¼‚æ­¥IO**ï¼šä½¿ç”¨asyncioæé«˜å¹¶å‘æ€§èƒ½
- â¬œ **æ•°æ®å‹ç¼©**ï¼šä¼ è¾“å‰å‹ç¼©æ•°æ®åŒ…

---

## åäºŒã€æ€»ç»“

### 12.1 è®¾è®¡ä¼˜ç‚¹

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
2. **é…ç½®çµæ´»**ï¼šæ‰€æœ‰å‚æ•°é€šè¿‡YAMLé…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
3. **æ•°æ®çœŸå®**ï¼šç®—æ³•æ¨¡æ‹ŸçœŸå®ä¼ æ„Ÿå™¨ç‰¹æ€§ï¼Œæ•°æ®å¯ä¿¡
4. **åè®®å®Œæ•´**ï¼šå®Œæ•´çš„ZigBeeåè®®æ ˆæ¨¡æ‹Ÿ
5. **å®¹é”™æœºåˆ¶**ï¼šè‡ªåŠ¨é‡è¿ã€å¼‚å¸¸å¤„ç†ã€æ—¥å¿—è®°å½•
6. **æµ‹è¯•å‹å¥½**ï¼šæä¾›MockCommunicatorç”¨äºç¦»çº¿æµ‹è¯•

### 12.2 é€‚ç”¨åœºæ™¯

- âœ… ç³»ç»Ÿå¼€å‘å’Œè°ƒè¯•
- âœ… åŠŸèƒ½æµ‹è¯•å’ŒéªŒè¯
- âœ… æ€§èƒ½å‹åŠ›æµ‹è¯•
- âœ… é¡¹ç›®æ¼”ç¤ºå±•ç¤º
- âœ… æ•™å­¦åŸ¹è®­

### 12.3 ä½¿ç”¨å»ºè®®

1. **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨`--mock`å‚æ•°è¿›è¡Œæµ‹è¯•
2. **è”è°ƒé˜¶æ®µ**ï¼šè¿æ¥çœŸå®åç«¯ï¼ŒéªŒè¯æ•°æ®æµ
3. **å‹åŠ›æµ‹è¯•**ï¼šå¢åŠ èŠ‚ç‚¹æ•°é‡ï¼Œæµ‹è¯•ç³»ç»Ÿæé™
4. **æ¼”ç¤ºå±•ç¤º**ï¼šåˆ‡æ¢åˆ°å¼‚å¸¸æ¨¡å¼ï¼Œå±•ç¤ºå‘Šè­¦åŠŸèƒ½

---

## é™„å½•

### A. æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|-----|------|------|
| main.py | 180 | ä¸»ç¨‹åºå…¥å£ |
| config.py | 150 | é…ç½®ç®¡ç† |
| data_generator.py | 200 | æ•°æ®ç”Ÿæˆ |
| zigbee_protocol.py | 150 | åè®®å°è£… |
| communication.py | 180 | ç½‘ç»œé€šä¿¡ |
| config.yaml | 70 | é…ç½®æ–‡ä»¶ |
| requirements.txt | 1 | ä¾èµ–åˆ—è¡¨ |
| README.md | 200 | ä½¿ç”¨è¯´æ˜ |

**æ€»ä»£ç é‡**ï¼šçº¦1000è¡ŒPythonä»£ç 

### B. ä¾èµ–é¡¹

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|------|
| PyYAML | >=6.0 | YAMLé…ç½®æ–‡ä»¶è§£æ |
| Python | >=3.7 | è¿è¡Œç¯å¢ƒ |

### C. å‚è€ƒèµ„æ–™

1. ZigBeeè”ç›ŸæŠ€æœ¯è§„èŒƒ
2. Python socketç¼–ç¨‹æ–‡æ¡£
3. DHT11/DHT22ä¼ æ„Ÿå™¨æ‰‹å†Œ
4. MQç³»åˆ—æ°”ä½“ä¼ æ„Ÿå™¨æ‰‹å†Œ

---

**æ–‡æ¡£ç¼–åˆ¶**ï¼šå¼€å‘å›¢é˜Ÿ  
**å®¡æ ¸**ï¼šé¡¹ç›®è´Ÿè´£äºº  
**æ—¥æœŸ**ï¼š2025å¹´11æœˆ19æ—¥  
**ç‰ˆæœ¬**ï¼šv1.0

---

*æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†WSNç‰›æ£šç¯å¢ƒç›‘æµ‹ç³»ç»Ÿä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå™¨çš„è®¾è®¡ä¸å®ç°ï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æ¨¡å—è¯´æ˜ã€ç®—æ³•åŸç†ã€é…ç½®ç®¡ç†å’Œä½¿ç”¨æŒ‡å—ï¼Œä¸ºå¼€å‘ã€æµ‹è¯•å’Œä½¿ç”¨æä¾›å®Œæ•´çš„æŠ€æœ¯å‚è€ƒã€‚*