# å®ä½“ç±»ä¸æ•°æ®åº“æ˜ å°„é—®é¢˜ä¿®æ­£æ¸…å•

## ä¿®æ­£æ¦‚è¦

æ ¹æ®æ•°æ®åº“çœŸå®ç»“æ„æ£€æŸ¥,å‘ç°ä»¥ä¸‹å®ä½“ç±»å’ŒMapperå­˜åœ¨å­—æ®µæ˜ å°„é—®é¢˜,éœ€è¦ä¿®æ­£:

---

## 1. âœ… AlarmRecord (å‘Šè­¦è®°å½•) - éœ€è¦ä¿®æ­£

### æ•°æ®åº“çœŸå®å­—æ®µ
```sql
id, node_id, alarm_type, alarm_level, current_value, threshold_value, 
alarm_time, status, handle_time, remark
```

### å®ä½“ç±»å­—æ®µé—®é¢˜

| æ•°æ®åº“å­—æ®µ | å®ä½“ç±»å±æ€§ | çŠ¶æ€ | é—®é¢˜è¯´æ˜ |
|-----------|-----------|------|---------|
| id | id | âœ… æ­£ç¡® | |
| node_id | nodeId | âœ… æ­£ç¡® | |
| alarm_type | alarmType | âœ… æ­£ç¡® | |
| alarm_level | alarmLevel | âœ… æ­£ç¡® | |
| current_value | currentValue | âœ… æ­£ç¡® | |
| threshold_value | threshold | âŒ **é”™è¯¯** | å®ä½“ç±»å‘½åä¸º`threshold`,åº”ä¸º`thresholdValue` |
| alarm_time | alarmTime | âœ… æ­£ç¡® | |
| status | handleStatus | âŒ **é”™è¯¯** | å®ä½“ç±»å‘½åä¸º`handleStatus`,åº”ä¸º`status` |
| handle_time | handleTime | âœ… æ­£ç¡® | |
| remark | handleRemark | âŒ **é”™è¯¯** | å®ä½“ç±»å‘½åä¸º`handleRemark`,åº”ä¸º`remark` |

### Mapper XMLé—®é¢˜
- âœ… resultMapä¸­`threshold_value`æ˜ å°„åˆ°`threshold`(éœ€éšå®ä½“ç±»ä¸€èµ·ä¿®æ­£)
- âœ… resultMapä¸­`status`æ˜ å°„åˆ°`handleStatus`(éœ€éšå®ä½“ç±»ä¸€èµ·ä¿®æ­£)
- âœ… resultMapä¸­`remark`æ˜ å°„åˆ°`handleRemark`(éœ€éšå®ä½“ç±»ä¸€èµ·ä¿®æ­£)

### ä¿®æ­£æ–¹æ¡ˆ
**é€‰é¡¹1(æ¨è):** ä¿®æ”¹Mapper XML,ä¿æŒå®ä½“ç±»å­—æ®µåä¸å˜
**é€‰é¡¹2:** ä¿®æ”¹å®ä½“ç±»å­—æ®µåä»¥å®Œå…¨åŒ¹é…æ•°æ®åº“å‘½åè§„èŒƒ

---

## 2. âŒ DeviceInfo (è®¾å¤‡ä¿¡æ¯) - æœ‰ä¸¥é‡é—®é¢˜

### æ•°æ®åº“çœŸå®å­—æ®µ
```sql
id, device_id, device_name, device_type, status, auto_mode, control_mode,
create_time, update_time
```

### å®ä½“ç±»å­—æ®µé—®é¢˜

| æ•°æ®åº“å­—æ®µ | å®ä½“ç±»å±æ€§ | çŠ¶æ€ | é—®é¢˜è¯´æ˜ |
|-----------|-----------|------|---------|
| id | id | âœ… æ­£ç¡® | |
| device_id | deviceId | âœ… æ­£ç¡® | |
| device_name | deviceName | âœ… æ­£ç¡® | |
| device_type | deviceType | âœ… æ­£ç¡® | |
| status | status | âœ… æ­£ç¡® | |
| auto_mode | autoMode | âœ… æ­£ç¡® | |
| control_mode | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |
| create_time | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |
| update_time | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |
| âŒ | location | **ä¸å­˜åœ¨** | å®ä½“ç±»æœ‰æ­¤å­—æ®µ,ä½†æ•°æ®åº“æ²¡æœ‰ |
| âŒ | installDate | **ä¸å­˜åœ¨** | å®ä½“ç±»æœ‰æ­¤å­—æ®µ,ä½†æ•°æ®åº“æ²¡æœ‰ |
| âŒ | lastOpTime | **ä¸å­˜åœ¨** | å®ä½“ç±»æœ‰æ­¤å­—æ®µ,ä½†æ•°æ®åº“æ²¡æœ‰ |
| âŒ | remark | **ä¸å­˜åœ¨** | å®ä½“ç±»æœ‰æ­¤å­—æ®µ,ä½†æ•°æ®åº“æ²¡æœ‰ |

### Mapper XMLé—®é¢˜
- âŒ DeviceInfoMapper.xmlä¸­å¼•ç”¨äº†ä¸å­˜åœ¨çš„æ•°æ®åº“å­—æ®µ:`location`, `install_date`, `last_op_time`, `remark`
- âŒ ç¼ºå°‘å¯¹å®é™…å­˜åœ¨çš„å­—æ®µçš„æ˜ å°„:`control_mode`, `create_time`, `update_time`

### ä¿®æ­£æ–¹æ¡ˆ
**å¿…é¡»ä¿®æ­£!** å®ä½“ç±»å’ŒMapperä¸æ•°æ®åº“ä¸¥é‡ä¸ç¬¦,ä¼šå¯¼è‡´SQLé”™è¯¯

---

## 3. âŒ NodeInfo (èŠ‚ç‚¹ä¿¡æ¯) - æœ‰ä¸¥é‡é—®é¢˜

### æ•°æ®åº“çœŸå®å­—æ®µ
```sql
id, node_id, node_name, location, status, battery_level, signal_strength,
last_comm_time, install_date, remark, last_online_time, create_time, update_time
```

### å®ä½“ç±»å­—æ®µé—®é¢˜

| æ•°æ®åº“å­—æ®µ | å®ä½“ç±»å±æ€§ | çŠ¶æ€ | é—®é¢˜è¯´æ˜ |
|-----------|-----------|------|---------|
| id | id | âœ… æ­£ç¡® | |
| node_id | nodeId | âœ… æ­£ç¡® | |
| node_name | nodeName | âœ… æ­£ç¡® | |
| location | location | âœ… æ­£ç¡® | |
| status | status | âœ… æ­£ç¡® | |
| battery_level | batteryLevel | âœ… æ­£ç¡® | |
| signal_strength | signalStrength | âœ… æ­£ç¡® | |
| last_comm_time | lastCommTime | âœ… æ­£ç¡® | |
| install_date | installDate | âœ… æ­£ç¡® | |
| remark | remark | âœ… æ­£ç¡® | |
| last_online_time | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |
| create_time | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |
| update_time | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |

### Mapper XMLé—®é¢˜
- âŒ NodeInfoMapper.xmlä¸­ç¼ºå°‘å¯¹`last_online_time`, `create_time`, `update_time`çš„æ˜ å°„

### ä¿®æ­£æ–¹æ¡ˆ
**å»ºè®®ä¿®æ­£** - æ·»åŠ ç¼ºå¤±çš„æ—¶é—´å­—æ®µä»¥å®Œæ•´æ˜ å°„æ•°æ®åº“ç»“æ„

---

## 4. âŒ SensorData (ä¼ æ„Ÿå™¨æ•°æ®) - æœ‰é—®é¢˜

### æ•°æ®åº“çœŸå®å­—æ®µ
```sql
id, node_id, temperature, humidity, nh3_concentration, h2s_concentration,
data_status, collect_time, create_time
```

### å®ä½“ç±»å­—æ®µé—®é¢˜

| æ•°æ®åº“å­—æ®µ | å®ä½“ç±»å±æ€§ | çŠ¶æ€ | é—®é¢˜è¯´æ˜ |
|-----------|-----------|------|---------|
| id | id | âœ… æ­£ç¡® | |
| node_id | nodeId | âœ… æ­£ç¡® | |
| temperature | temperature | âœ… æ­£ç¡® | |
| humidity | humidity | âœ… æ­£ç¡® | |
| nh3_concentration | nh3Concentration | âœ… æ­£ç¡® | |
| h2s_concentration | h2sConcentration | âœ… æ­£ç¡® | |
| data_status | âŒ **ç¼ºå¤±** | æ•°æ®åº“æœ‰æ­¤å­—æ®µ,ä½†å®ä½“ç±»æ²¡æœ‰ |
| collect_time | collectTime | âœ… æ­£ç¡® | |
| create_time | receiveTime | âš ï¸ **å‘½åä¸ä¸€è‡´** | å®ä½“ç±»å‘½åä¸º`receiveTime` |

### Mapper XMLé—®é¢˜
- âŒ SensorDataMapper.xmlä¸­ç¼ºå°‘å¯¹`data_status`çš„æ˜ å°„
- âš ï¸ resultMapå°†`create_time`æ˜ å°„åˆ°`receiveTime`(å‘½åä¸ä¸€è‡´ä½†åŠŸèƒ½æ­£ç¡®)

### ä¿®æ­£æ–¹æ¡ˆ
**å»ºè®®ä¿®æ­£** - æ·»åŠ `data_status`å­—æ®µ,è€ƒè™‘ç»Ÿä¸€å‘½åè§„èŒƒ

---

## 5. âœ… SystemConfig (ç³»ç»Ÿé…ç½®) - å®Œå…¨æ­£ç¡®

### æ•°æ®åº“çœŸå®å­—æ®µ
```sql
id, config_key, config_type, config_value, description, create_time, update_time
```

### å®ä½“ç±»å­—æ®µ
æ‰€æœ‰å­—æ®µå®Œå…¨åŒ¹é… âœ…

### Mapper XML
æ‰€æœ‰æ˜ å°„å®Œå…¨æ­£ç¡® âœ…

---

## 6. âœ… DeviceControlLog (è®¾å¤‡æ§åˆ¶æ—¥å¿—) - å·²ä¿®æ­£

### æ•°æ®åº“çœŸå®å­—æ®µ
```sql
id, device_id, control_action, control_mode, operator, control_time, reason
```

### å®ä½“ç±»å­—æ®µ
æ‰€æœ‰å­—æ®µå·²æ­£ç¡®æ˜ å°„ âœ… (ç»è¿‡å‰é¢çš„ä¿®æ­£)

### Mapper XML
æ‰€æœ‰æ˜ å°„å·²æ­£ç¡® âœ… (ç»è¿‡å‰é¢çš„ä¿®æ­£)

---

## ä¿®æ­£ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§(å¿…é¡»ç«‹å³ä¿®æ­£)
1. **DeviceInfo** - å®ä½“ç±»å’ŒMapperä¸æ•°æ®åº“ä¸¥é‡ä¸ç¬¦,ä¼šå¯¼è‡´INSERT/UPDATEå¤±è´¥
   - åˆ é™¤ä¸å­˜åœ¨çš„å­—æ®µ:`location`, `installDate`, `lastOpTime`, `remark`
   - æ·»åŠ ç¼ºå¤±çš„å­—æ®µ:`controlMode`, `createTime`, `updateTime`
   - ä¿®æ­£æ‰€æœ‰Mapper XMLçš„SQLè¯­å¥

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§(å½±å“åŠŸèƒ½å®Œæ•´æ€§)
2. **NodeInfo** - ç¼ºå°‘æ—¶é—´è·Ÿè¸ªå­—æ®µ
   - æ·»åŠ :`lastOnlineTime`, `createTime`, `updateTime`

3. **SensorData** - ç¼ºå°‘æ•°æ®çŠ¶æ€å­—æ®µ
   - æ·»åŠ :`dataStatus`

### ğŸŸ¢ ä½ä¼˜å…ˆçº§(å‘½åè§„èŒƒé—®é¢˜)
4. **AlarmRecord** - å­—æ®µå‘½åä¸ç»Ÿä¸€
   - å¯é€šè¿‡Mapperæ˜ å°„è§£å†³,ä¸å¼ºåˆ¶ä¿®æ”¹å®ä½“ç±»

---

## è¯¦ç»†ä¿®æ­£ä»£ç 

### ä¿®æ­£1: DeviceInfo.java (é«˜ä¼˜å…ˆçº§)

```java
package com.wsn.cow.entity;

import lombok.Data;
import java.util.Date;

@Data
public class DeviceInfo {
    private Long id;
    private String deviceId;
    private String deviceName;
    private String deviceType;
    private Integer status;
    private Integer autoMode;
    private Integer controlMode;  // æ–°å¢
    private Date createTime;      // æ–°å¢
    private Date updateTime;      // æ–°å¢
    
    // åˆ é™¤: location, installDate, lastOpTime, remark
}
```

### ä¿®æ­£2: DeviceInfoMapper.xml (é«˜ä¼˜å…ˆçº§)

éœ€è¦å®Œå…¨é‡å†™æ‰€æœ‰SQLè¯­å¥,åˆ é™¤ä¸å­˜åœ¨å­—æ®µçš„å¼•ç”¨,å‚è€ƒæ•°æ®åº“çœŸå®ç»“æ„æ–‡æ¡£ã€‚

### ä¿®æ­£3: NodeInfo.java (ä¸­ä¼˜å…ˆçº§)

```java
@Data
public class NodeInfo {
    // ... ç°æœ‰å­—æ®µ ...
    private Date lastOnlineTime;  // æ–°å¢
    private Date createTime;      // æ–°å¢  
    private Date updateTime;      // æ–°å¢
}
```

### ä¿®æ­£4: SensorData.java (ä¸­ä¼˜å…ˆçº§)

```java
@Data
public class SensorData {
    // ... ç°æœ‰å­—æ®µ ...
    private Integer dataStatus;   // æ–°å¢
    // receiveTime å¯é‡å‘½åä¸º createTime ä»¥åŒ¹é…æ•°æ®åº“
}
```

---

## ä¿®æ­£åéªŒè¯æ¸…å•

- [ ] é‡æ–°ç¼–è¯‘é¡¹ç›®: `mvn clean compile`
- [ ] æ£€æŸ¥ç¼–è¯‘é”™è¯¯å’Œè­¦å‘Š
- [ ] æµ‹è¯•æ‰€æœ‰è®¾å¤‡ç›¸å…³API (GET /list, POST /controlç­‰)
- [ ] æµ‹è¯•èŠ‚ç‚¹ç®¡ç†API
- [ ] æµ‹è¯•ä¼ æ„Ÿå™¨æ•°æ®API  
- [ ] éªŒè¯æ•°æ®èƒ½æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
- [ ] æ£€æŸ¥æ—¥å¿—æ— SQLé”™è¯¯

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´:** 2025-11-18  
**æ£€æŸ¥èŒƒå›´:** æ‰€æœ‰7å¼ è¡¨çš„å®ä½“ç±»å’ŒMapper XML  
**å‘ç°é—®é¢˜:** 3ä¸ªå®ä½“ç±»å­˜åœ¨ä¸¥é‡å­—æ®µä¸åŒ¹é…é—®é¢˜
